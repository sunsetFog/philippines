var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(s,n){function r(t){try{a(o.next(t))}catch(e){n(e)}}function h(t){try{a(o["throw"](t))}catch(e){n(e)}}function a(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,h)}a((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,n&&(r=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(o){i=[6,o],n=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,n,r,h,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},fishjoy;!function(t){var e=function(){function t(t,e){this._mId=0,this._mIsDead=!0,this._mIsOver=!0,this._mParent=null,this.x=0,this.y=0,this.mSpeed=1,this.mAddSpeed=0,this.mSpeedX=1,this.mSpeedY=1,this.mRotation=0,this.mRadian=0,this._mServerId=-1,this._mIsDestroy=!1,this._mCurrTime=0,this._mIt=0,this._mId=t,this._mParent=e}return t.prototype.init=function(){this._mRender=new egret.DisplayObjectContainer,this._mRender.touchEnabled=!1,this._mRender.touchChildren=!1},t.prototype.setParent=function(t){this._mParent=t},t.prototype.refresh=function(t){this._mId=t,this._mIsDead=!1,this._mIsOver=!1},t.prototype.setTime=function(t){this._mCurrTime=t},t.prototype.it=function(){return this._mIt},t.prototype.updateAddByTime=function(t){for(var e=Math.floor(t/16),i=0;e>i;i++)this.update(this._mCurrTime+16)},t.prototype.update=function(t){this._mIt=t-this._mCurrTime,this._mCurrTime=t},t.prototype.clean=function(){this.removeRender(),this._mRender.rotation=0,this._mRender.scaleX=1,this._mRender.scaleY=1,this._mRender.removeChildren(),this._mId=0,this._mIsDead=!0,this._mIsOver=!0,this.mRotation=0,this.mRadian=0,this.mSpeedX=1,this.mSpeedY=1,this._mServerId=-1,this._mCurrTime=0,this._mIt=0},t.prototype.setServerId=function(t){this._mServerId=t},t.prototype.getServerId=function(){return this._mServerId},Object.defineProperty(t.prototype,"mId",{get:function(){return this._mId},set:function(t){this._mId=t},enumerable:!0,configurable:!0}),t.prototype.isDead=function(){return this._mIsDead},t.prototype.isOver=function(){return this._mIsOver},t.prototype.setDead=function(){this._mIsDead=!0},t.prototype.setOver=function(){this._mIsOver=!0},Object.defineProperty(t.prototype,"isLive",{get:function(){return!this._mIsDead&&!this._mIsOver},enumerable:!0,configurable:!0}),t.prototype.removeRender=function(){R.removeFromParent(this._mRender)},t.prototype.destroy=function(){this.clean(),this._mIsDestroy=!0,this._mParent=void 0,this._mRender=void 0},t}();t.FishJoyBase=e,__reflect(e.prototype,"fishjoy.FishJoyBase")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._mMasterIndexWorld=1,i._mMasterIndex=0,i._mMaster=null,i._mFishPlayers=null,i}return __extends(i,e),i.prototype.inits=function(){e.prototype.inits.call(this),this._mFishPlayers=[null];for(var i=0;4>i;i++)this._mFishPlayers.push(new t.FishPlayer)},i.prototype.addListeners=function(){e.prototype.addListeners.call(this)},i.prototype.initFishPlayerRender=function(t,e){var i=this.getPlayer(t);i.initRender(e),i.mIsMaster&&i.getRender().showSeatBubble(),t>2&&i.getRender().setBowAngle(90)},i.prototype.addPlayer=function(t,e){Log.log("controller.addPlayer。updateInfo",e,",index=",t);var i=this.getPlayer(t);i.initPlayerInfo(e),i.updateInfo()},i.prototype.exitPlayer=function(t){this.getPlayer(t).playerExit()},i.prototype.refreshPlayer=function(t){this.getPlayer(t).updateInfo()},i.prototype.masterFire=function(t){var e=this.master;e.fire(),e.getRender().setBowAngle(t)},i.prototype.checkMoneyEnough=function(){var t=!0,e=this.master;return Log.log("发炮请求前，检测钱是否足够：money=",e.mMoney,",needMoney=",e.fireNeedMoney()),(e.mMoney<=0||e.mMoney<e.fireNeedMoney())&&(t=!1),t},i.prototype.scaleCoinEffect=function(t){this.getPlayer(t).getRender().scaleCoinEffect()},i.prototype.hideCali=function(){var t=this.master;1==t.getRender().u_gCalibration.visible&&t.getRender().showCap()},Object.defineProperty(i.prototype,"masterIndex",{get:function(){return this.master.mPlayerClientIndex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"masterServerSeaNumber",{get:function(){return this.master.mPlayerSeaNumber},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"master",{get:function(){if(this._mMaster)return this._mMaster;for(var t=this._mFishPlayers.length-1;t>=1;t--){var e=this._mFishPlayers[t];if(e.mIsMaster)return this._mMaster=e,this._mMaster}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"masterPos",{get:function(){return this.getPlayerPos(this.masterIndex)},enumerable:!0,configurable:!0}),i.prototype.masterUpdateAngle=function(t){this.master.getRender().setBowAngle(t)},i.prototype.getPlayer=function(t){return this._mFishPlayers[t]},i.prototype.getPlayerBySeaNumber=function(t){var e=i.SeaMap[t+1];return this._mFishPlayers[e]},i.prototype.getPlayerByUID=function(t){for(var e,i=this._mFishPlayers.length,o=1;i>o;o++)if(t==this._mFishPlayers[o]._mPlayerUid){e=this._mFishPlayers[o];break}return e},i.prototype.getPlayerPos=function(e){return t.FishConst.CannonPosList[e]},i.prototype.updateAngle=function(t,e){this.getPlayer(t).getRender().setBowAngle(e)},i.prototype.updateCannonId=function(t,e){this.getPlayer(t).updateCannon(e)},i.prototype.fire=function(t,e,i){void 0===i&&(i=!1);var o=this.getPlayer(t);i||o.fire(),o.getRender().setBowAngle(e)},i.prototype.destroy=function(){for(e.prototype.destroy.call(this);this._mFishPlayers.length;){var t=this._mFishPlayers.pop();t&&t.destroy()}this._mFishPlayers=void 0},i.SeaMap=[1,2,3,4],i}(base.GameSeparateCtrl);t.FishPlayerController=e,__reflect(e.prototype,"fishjoy.FishPlayerController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this,null)||this;return e.init(),e.update(),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.update=function(){var t="arm_effect";this.initDBRes(t),this.armature=this.createArmature("anim",t,e._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},e.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(){this.armature.play(e.Animation,1)},e.prototype.stop=function(){this.armature.stop()},e.prototype.armaturePlayEnd=function(t){t.animationName==e.Animation&&(this.armature.stop(),this._mCallBack&&this._mCallBack.call(this._mThisobj))},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mCallBack=void 0,this._mThisobj=void 0,this.armature=void 0},e.Animation="1",e._mActionList=[e.Animation],e}(base.BaseGameObject);t.ArmBones=e,__reflect(e.prototype,"fishjoy.ArmBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t,i){var o=e.call(this,t,i)||this;return o._mIcon=null,o._mHitPoint=null,o._mNetId=0,o._mIsMaster=!1,o.init(),o}return __extends(i,e),i.create=function(t,e){return ObjectPool.pop("fishjoy.Bullet",t,e)},i.release=function(t){t.clean(),ObjectPool.push(t)},i.prototype.init=function(){e.prototype.init.call(this),this._mIcon=new eui.Image,this._mHitPoint=new egret.Point,this.mSpeed=10},i.prototype.refresh=function(i){e.prototype.refresh.call(this,i),this._mRender.parent||(this._mParent.addChild(this._mRender),this._mRender.addChild(this._mIcon));var o=t.FishUtil.getCannonConfigById(this.mId);this.mSpeed=o.bullet_speed,this._mIcon.texture=RES.getRes("fishjoy_cannon_json."+o.bullet_assets),this._mIcon.anchorOffsetX=this._mIcon.width/2,this._mIcon.anchorOffsetY=this._mIcon.height/2},i.prototype.updateNetId=function(t){this._mNetId=t},i.prototype.setMaster=function(t){this._mIsMaster=t},i.prototype.update=function(t){e.prototype.update.call(this,t);var i=this.it();if(!(this.isDead()||0>=i)){if(i>30)return void this.updateAddByTime(i);var o=this.mSpeed*i/16;if(this.x<0||this.x>GameBase.GameWidth?(this.x<=0&&(this.x=0),this.x>=GameBase.GameWidth&&(this.x=GameBase.GameWidth),this.mSpeedX=-this.mSpeedX,this.rebound(o)):(this.y<0||this.y>GameBase.GameHeight)&&(this.y<=0&&(this.y=0),this.y>=GameBase.GameHeight&&(this.y=GameBase.GameHeight),this.mSpeedY=-this.mSpeedY,this.rebound(o)),this.getLockFishSId()>0){var s=this._mFish,n=s.getX(),r=s.getY();s.isOut()||!s.isLive?this.setFish(null):this.setRotation(App.MathUtils.getAngle2(this.x,this.y,n,r))}var h=this.x+o*Math.cos(this.mRadian)*this.mSpeedX,a=this.y+o*Math.sin(this.mRadian)*this.mSpeedY;this.setPos(h,a)}},i.prototype.rebound=function(t){var e=this.x+Math.cos(this.mRadian)*this.mSpeedX,i=this.y+Math.sin(this.mRadian)*this.mSpeedY;this.mRotation=App.MathUtils.getAngle2(this.x,this.y,e,i),this.updateDisplayAngel()},i.prototype.setRotation=function(t){this.mRotation=t,this.mRadian=App.MathUtils.getRadian(t),this.updateDisplayAngel()},i.prototype.updateDisplayAngel=function(){this._mRender.rotation=this.mRotation+90},i.prototype.setPos=function(t,e){this.x=t,this.y=e,this._mRender.x=t,this._mRender.y=e,this._mHitPoint.x=t,this._mHitPoint.y=e},i.prototype.getHitBound=function(){return this._mHitPoint},i.prototype.getNetId=function(){return this._mNetId},i.prototype.getLockFishSId=function(){return this._mFish?this._mFish.getServerId():0},i.prototype.setFish=function(t){this._mFish=t,this.mSpeedX=1,this.mSpeedY=1},Object.defineProperty(i.prototype,"mIsMaster",{get:function(){return this._mIsMaster},enumerable:!0,configurable:!0}),i.prototype.clean=function(){e.prototype.clean.call(this),this._mIcon&&(this._mIcon.texture=void 0,this._mIcon.$bitmapData=void 0),this._mNetId=0,this._mFish=void 0,this._mIsMaster=!1},i.prototype.destroy=function(){this._mIsDestroy||(this.clean(),e.prototype.destroy.call(this),this._mIcon=void 0)},i}(t.FishJoyBase);t.Bullet=e,__reflect(e.prototype,"fishjoy.Bullet")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){var t=e.call(this,null)||this;return t._mCurrId=0,t}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this)},i.prototype.updateId=function(e){if(this._mCurrId!=e){this._mCurrId=e;var o=t.FishUtil.getCannonConfigById(e),s=o.gun_assets;this.initDBRes(s),this.armature=this.createArmature("Armature",s,i._mActionList),this.armature.y=-14}},i.prototype.setPosition=function(t,e){this.x=t,this.y=e},i.prototype.play=function(){this.armature.play(i.Animation,1)},i.prototype.clean=function(){e.prototype.clean.call(this)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._mCurrId=0,this.armature=void 0},i.Animation="fire",i._mActionList=[i.Animation],i}(base.BaseGameObject);t.CannonBones=e,__reflect(e.prototype,"fishjoy.CannonBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.No_Rotation_FishIds={},t}();__reflect(e.prototype,"FishCfg");var i=function(i){function o(t,e){var o=i.call(this,t,e)||this;return o.__PoolId=0,o.speedCoefficient=1e4,o._mFishBones=null,o._mFishShandow=null,o._mCurrPointIndex=0,o._mPath={},o._mBitHit=0,o._mIsRunAways=!1,o._mIsTideFish=!1,o._mRenderNum=0,o._mHitRectViewList=[],o._mCurrAngel=0,o._mNextAngel=0,o._mDealAngel=0,o._mHitFilter=[ColorFilters.FilterGold],o.init(),o.__PoolId=t,o}return __extends(o,i),o.create=function(t,e){var i,s=o.__mFishPool["FishPool_"+t];return s&&(i=s.shift()),i||(i=new o(t,e)),i.setParent(e),i.mId=t,i},o.release=function(t){var e=o.__mFishPool["FishPool_"+t.__PoolId];e||(e=[]),t.clean(),e.push(t),o.__mFishPool["FishPool_"+t.__PoolId]=e},o.clearPool=function(){var t=o.__mFishPool;for(var e in t){for(var i=t[e];i.length;){var s=i.pop();s.destroy()}delete t[e]}},o.prototype.init=function(){i.prototype.init.call(this),this._mHitPointList=[],this._mBounds=new egret.Rectangle,this._mFishBones=new t.FishBones,this._mFishShandow=new t.FishShandowBones,this._mTxtId=new egret.TextField,this._mTxtId.size=16,this._mTxtId.width=200,this._mTxtId.anchorOffsetX=100,this._mTxtId.textAlign=egret.HorizontalAlign.CENTER,this._mIconArm=new eui.Image},o.prototype.initRenders=function(){this._mRender.visible=!0,this._mRender.parent&&R.removeFromParent(this._mRender),this._mTideShandowGroup.addChild(this._mFishShandow),this._mParent.addChild(this._mRender),this._mRender.addChild(this._mFishBones),this._mRender.addChild(this._mTxtId),this._mFishBones.updateId("fish_"+this.mId),this._mFishShandow.updateId("shadow_"+this.mId),this.refreshHitPoints(),this._mTxtId.text=""+this.getServerId(),this._mTxtId.visible=t.FishConst.mIsShowFishHit},o.prototype.refreshHitPoints=function(){var e=t.FishUtil.getFishHitRect(this.mId);if(!e)return void egret.error("没有碰撞配置 type:",this.mId);for(var i=this._mHitPointList,o=0,s=e.length-1;s>=o;o++){var n=e[o],r=n.radius,h=i[o];h||(h={},i.push(h)),h.x=n.dot.x,h.y=n.dot.y,h.m_r=r,this._mBitHit<n.dot.x+r&&(this._mBitHit=n.dot.x+r),this._mBitHit<n.dot.y+r&&(this._mBitHit=n.dot.y+r),h.isOnHit=!0}t.FishConst.mIsShowFishHit&&this.refreshHitRect()},o.prototype.refreshHitRect=function(){for(var e=this._mHitPointList,i=this._mHitRectViewList,o=e.length-1;o>=0;o--){var s=e[o],n=i[o];if(n||(n=new egret.Sprite,this._mHitRectViewList.push(n)),t.FishConst.mIsShowFishHit){var r=s.m_r;n.m_r!=r&&(n.graphics.clear(),n.graphics.beginFill(16711680,.3),n.graphics.drawCircle(0,0,r),n.graphics.endFill()),n.x=s.x,n.y=s.y,n.m_r=r,n.parent||this._mRender.addChild(n)}else R.removeFromParent(n)}this._mTxtId.visible=t.FishConst.mIsShowFishHit},o.prototype.refreshFish=function(e,o,s){i.prototype.refresh.call(this,this.mId),this._mPath=e,this._mIsTideFish=null==e,this._mIsTideFish||(this.speedCoefficient=t.FishUtil.getFishSpeedCoef(this.mId)),this.initRenders(),this.updatePos(0,o,s,-1),this.play()},o.prototype.play=function(){this._mFishBones.play(),this._mFishShandow.play()},o.prototype.playDead=function(t){this.tideDied(t),this.setOver(),this.cleanLock(),this._mFishBones.dead(),this._mFishShandow.dead(),this._mFishBones.initPlayedEndCallBack(this.playEnd,this)},o.prototype.tideDied=function(t){this._mIsTideFish&&t&&(this.removeRender(),this._mParent=t,this._mParent.addChild(this._mRender),R.removeFromParent(this._mFishShandow),this._mParent.addChild(this._mFishShandow),this.setPos(this.getX(),this.getY()),this._mIsTideFish=!1)},o.prototype.playEnd=function(){this.setDead()},o.prototype.updatePos=function(t,e,i,s){if(!this._mIsTideFish&&t>=0){this._mCurrPointIndex=t;var n=this.getPoint(this._mCurrPointIndex);this.mSpeed=-1==s?n.s/o.D_Speed:s,this.mSpeed=this.mSpeed*(this.speedCoefficient/1e4),this.mAddSpeed=n.a/o.D_Speed,this.setPos(e?e:n.x,i?i:n.y)}},o.prototype.update=function(t){i.prototype.update.call(this,t);var e=this.it();if(this._mRenderNum++,!(this.isDead()||this.isOver()||0>=e||(this.check(),this._mIsTideFish))){if(e>30)return void this.updateAddByTime(e);if(!this._mIsRunAways&&(this.mRadian=this.checkIsArrive()?this.nextRadian():this.mRadian,this.mRotation+=this._mDealAngel,this.setRotation(),this.mRadian==o.Err_Value))return void this.setDead();this.mSpeed+=this.mAddSpeed;var s=this.mSpeed*e/16,n=this.getX()+s*Math.cos(this.mRadian),r=this.getY()+s*Math.sin(this.mRadian);this.setPos(n,r)}},o.prototype.runAway=function(){this._mIsRunAways=!0,this.mAddSpeed=.5,this._mFishBones.play(5),this._mFishShandow.play(5),this.isOut()&&this.setDead()},o.prototype.setLock=function(){this._mIsLock=!0},o.prototype.cleanLock=function(){this._mIsLock=!1,this.clearArmIcon(),this.clearArmEffect()},o.prototype.addArmIcon=function(){this._mIconArm.parent||(this._mRender.addChild(this._mIconArm),this._mIconArm.texture=RES.getRes("grabfish_ui_arm"),this._mIconArm.x=-this._mIconArm.width/2,this._mIconArm.y=-this._mIconArm.height/2)},o.prototype.clearArmIcon=function(){this._mIsLock=!1,R.removeFromParent(this._mIconArm)},o.prototype.playArmEffect=function(){this._mArmEffect||(this._mArmEffect=new t.ArmBones,this._mArmEffect.initPlayedEndCallBack(this.removeArmEffcet,this)),this._mRender.addChild(this._mArmEffect),this._mArmEffect.play()},o.prototype.removeArmEffcet=function(){this.clearArmEffect(),Log.log("是否是锁定的鱼：",this._mIsLock),this._mIsLock&&this.addArmIcon()},o.prototype.clearArmEffect=function(){this._mArmEffect&&this._mArmEffect.parent&&(this._mArmEffect.stop(),this._mArmEffect.parent.removeChild(this._mArmEffect))},Object.defineProperty(o.prototype,"isLockedFish",{get:function(){var t=this._mIsLock;return t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mIsTideFish",{get:function(){return this._mIsTideFish},enumerable:!0,configurable:!0}),o.prototype.check=function(){if(this._mRenderNum%5==0){var t=this.getX(),e=this.getY(),i=this.getBounds().width/2,o=this.getBounds().height/2,s=-i>t||t>GameBase.GameWidth+i||-o>e||e>GameBase.GameHeight+o;if(this._mIsTideFish){var n=this._mRender.scaleX;(1==n&&t>GameBase.GameWidth+i||-1==n&&-i>t)&&this.setDead()}else(-500>t||t>GameBase.GameWidth+500||-500>e||e>GameBase.GameHeight+500)&&this.setDead();this._mRender.visible=!s}},o.prototype.setRotation=function(){return e.No_Rotation_FishIds[this.mId]?void this.setDirection(this.mRotation>90&&this.mRotation<270?-1:1):(this._mRender.rotation=this.mRotation,void(this._mFishShandow.rotation=this.mRotation))},o.prototype.setPos=function(t,e){this.x=t,this.y=e,this._mRender.x=t,this._mRender.y=e,this._mFishShandow.setPosition(t+2,e+80)},o.prototype.setDirection=function(t){this._mRender.scaleX=t,this._mFishShandow.scaleX=t},o.prototype.setYDirection=function(t){e.No_Rotation_FishIds[this.mId]||(this._mRender.scaleY=t,this._mFishShandow.scaleY=t)},o.prototype.setTideGroup=function(t){this._mTideGroup=t},o.prototype.setTideShandowGroup=function(t){this._mTideShandowGroup=t},o.prototype.checkIsArrive=function(){var t=this.getPoint(this._mCurrPointIndex),e=App.MathUtils.getDistance(t.x,t.y,this.getX(),this.getY());return e<this.mSpeed*this.it()/16||1>e},o.prototype.nextRadian=function(){var t=this.getPoint(this._mCurrPointIndex++),e=this.getPoint(this._mCurrPointIndex),i=this.getPoint(this._mCurrPointIndex+1);if(!e)return o.Err_Value;var s=Math.atan2(e.y-t.y,e.x-t.x);if(this._mCurrAngel=App.MathUtils.getAngle360(s),this._mNextAngel=this._mCurrAngel,i){var n=Math.atan2(i.y-e.y,i.x-e.x);this._mNextAngel=App.MathUtils.getAngle360(n)}return this.mRotation=this._mCurrAngel,this.mSpeed=t.s/o.D_Speed,this.mSpeed=this.mSpeed*(this.speedCoefficient/1e4),this.mAddSpeed=t.a/o.D_Speed,this.setPos(t.x,t.y),this._mDealAngel=this.getAngelRotation(s),this.setYDirection(e.x-t.x<0?-1:1),s},o.prototype.getAngelRotation=function(t){var e=this._mNextAngel-this._mCurrAngel;return e>180?e-=360:-180>e&&(e+=360),e/this.getFrames(t)},o.prototype.getFrames=function(t){for(var e=1,i=this.mSpeed,o=this.getX(),s=this.getY(),n=this.mAddSpeed,r=this.getPoint(this._mCurrPointIndex),h=Math.cos(t),a=Math.sin(t);9999>e;e++){i+=n,o+=i*h,s+=i*a;var l=App.MathUtils.getDistance(r.x,r.y,o,s);if(i>l)break}return e},o.prototype.getPoint=function(t){return this._mPath["data_"+t]},o.prototype.hitAction=function(){this._mFishBones.filters=this._mHitFilter,R.setTimeOnce(function(){this._mFishBones.filters=void 0},this,100)},o.prototype.hitTest=function(t){return this.isHit(t.x,t.y)},o.prototype.isHit=function(t,e){var i=this.getX(),o=this.getY();if(!App.HitUtils.pointHitCircle(t,e,i,o,this._mBitHit))return!1;for(var s=this._mHitPointList,n=egret.Point.create(0,0),r=!1,h=s.length-1;h>=0;h--){var a=s[h];if(a.isOnHit&&(this._mRender.localToGlobal(a.x,a.y,n),App.HitUtils.pointHitCircle(t,e,n.x,n.y,a.m_r))){r=!0;break}}return r},o.prototype.getX=function(){return this._mIsTideFish?this.x+this._mTideGroup.x:this.x},o.prototype.getY=function(){return this._mIsTideFish?this.y+this._mTideGroup.y:this.y},o.prototype.isOut=function(){var t=this.getX(),e=this.getY();return 0>t||t>GameBase.GameWidth||0>e||e>GameBase.GameHeight},o.prototype.hitTouch=function(t,e){return this.isDead()||this.isOver()?!1:this.isOut()?!1:this.isHit(t,e)},o.prototype.getBounds=function(){return this._mBounds.width<=0&&this._mFishBones.getBounds(this._mBounds),this._mBounds},o.prototype.restHit=function(){for(var t=this._mHitPointList,e=0,i=t.length-1;i>=e;e++){var o=t[e];o.isOnHit=!1}},o.prototype.clean=function(){i.prototype.clean.call(this),this.restHit(),this._mFishBones.clean(),this._mFishShandow.clean(),this.cleanLock(),this._mRenderNum=0,this._mRender.visible=!1,this._mIsRunAways=!1,this._mIsTideFish=!1,this._mIsLock=!1,this._mFishBones.filters=void 0,this._mIconArm.texture=void 0,this._mParent=void 0,this._mTideGroup=void 0,this._mTideShandowGroup=void 0},o.prototype.destroy=function(){i.prototype.destroy.call(this),this._mIconArm&&(this._mIconArm=void 0);for(var t=this._mHitRectViewList;t.length;)R.removeFromParent(t.pop());this._mHitPointList.length=0,this._mFishBones.destroy(),this._mFishShandow.destroy(),this._mIsLock=!1,this._mIsRunAways=!1,this._mIsTideFish=!1,this._mPath=void 0,this._mParent=void 0,this._mFishBones=void 0,this._mFishShandow=void 0,this._mRender=void 0,this._mHitPointList=void 0,this._mHitFilter=void 0,this._mTideGroup=void 0,this._mTideShandowGroup=void 0,this._mBounds=void 0,this._mHitRectViewList=void 0,this._mArmEffect&&(this.clearArmEffect(),this._mArmEffect.destroy(),this._mArmEffect=void 0)},o.__mFishPool={},o.Err_Value=999999,o.D_Speed=1e4,o}(t.FishJoyBase);t.Fish=i,__reflect(i.prototype,"fishjoy.Fish")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this,null)||this;return e._mIsOver=!1,e}return __extends(e,t),e.create=function(){return ObjectPool.pop("fishjoy.FishBigEffBone")},e.release=function(t){t.clean(),ObjectPool.push(t)},Object.defineProperty(e.prototype,"isOver",{get:function(){return this._mIsOver},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this),this._mIsOver=!1},e.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},e.prototype.initRes=function(t){var i=t;this.initDBRes(i),this.alpha=.6,i==e.special_large_res?this.armature=this.createArmature("anim",i,e._mActionList2):this.armature=this.createArmature("anim",i,e._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(t){this.visible=!1,t==e.special_large?this.initRes("fish_big_boom"):this.initRes("fish_newBoom"),egret.Tween.get(this).wait(200).call(function(){this.visible=!0,this.armature.play(t,1)}.bind(this),this)},e.prototype.clean=function(){t.prototype.clean.call(this),egret.Tween.removeTweens(this)},e.prototype.armaturePlayEnd=function(t){this._mIsOver=!0},e.prototype.destroy=function(){t.prototype.destroy.call(this),egret.Tween.removeTweens(this),this.armature=void 0},e.small="s",e.middle="m",e.large="l",e.special_large="boom-1",e.special_large_res="fish_big_boom",e._mActionList=[e.small,e.middle,e.large],e._mActionList2=["boom-1"],e}(base.BaseGameObject);t.FishBigEffBone=e,__reflect(e.prototype,"fishjoy.FishBigEffBone")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){return t.call(this,null)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},e.prototype.updateId=function(t){this.initDBRes(t),this.alpha=1,this.armature=this.createArmature("Armature",t,e._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(t){void 0===t&&(t=1),this.armature.play(e.Animation,999999,t)},e.prototype.dead=function(){this.armature.play(e.AnimationDead,2)},e.prototype.clean=function(){t.prototype.clean.call(this)},e.prototype.armaturePlayEnd=function(t){t.animationName==e.AnimationDead&&egret.Tween.get(this).to({alpha:0},500).call(function(){this._mCallBack&&this._mCallBack.call(this._mThisobj)}.bind(this))},e.prototype.destroy=function(){t.prototype.destroy.call(this),egret.Tween.removeTweens(this),this._mCallBack=void 0,this._mThisobj=void 0,this.armature=void 0},e.Animation="move",e.AnimationDead="dead",e._mActionList=[e.Animation,e.AnimationDead],e}(base.BaseGameObject);t.FishBones=e,__reflect(e.prototype,"fishjoy.FishBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this,null)||this;return e._mIsOver=!1,e}return __extends(e,t),e.create=function(){return ObjectPool.pop("fishjoy.FishHitBulbBones")},e.release=function(t){t.clean(),ObjectPool.push(t)},Object.defineProperty(e.prototype,"isOver",{get:function(){return this._mIsOver},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this),this._mIsOver=!1,this.initRes()},e.prototype.initRes=function(){var t="fishHit_effect";this.initDBRes(t),this.armature=this.createArmature("anim",t,e._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},e.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(){this.armature.play(e.Animation,1)},e.prototype.armaturePlayEnd=function(t){t.animationName==e.Animation&&this._mCallBack&&this._mCallBack.call(this._mThisobj),this._mIsOver=!0},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mCallBack=void 0,this._mThisobj=void 0,this.armature=void 0},e.Animation="bulb",e._mActionList=[e.Animation],e}(base.BaseGameObject);t.FishHitBulbBones=e,__reflect(e.prototype,"fishjoy.FishHitBulbBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function e(){this._mIsMaster=!1,this._mPlayerUid=0,this._mPlayerServerIndex=0,this._mPlayerClientIndex=0,this._mCannonId=0,this.mMoney=0,this._mNickName="",this._mCurrBulletCost=0}return e.prototype.initRender=function(t){this._mRender=t,this.refreshMaster()},e.prototype.initPlayerInfo=function(e){this._mPlayerServerIndex=e.server_index,this._mPlayerClientIndex=e.client_index,(3==this._mPlayerClientIndex||4==this._mPlayerClientIndex)&&(this._mRender.isTopSeat=!0),this._mIsMaster=e.server_index==e.masterIndex,this._mCannonId=e.paoId,this._mNickName=e.nick_name,this.mMoney=e.money,this._mPlayerUid=e.uid,t.FishPlayerController.SeaMap[e.server_index]=e.client_index,this.updateCannonCfg()},e.prototype.getRender=function(){return this._mRender},e.prototype.playerExit=function(){this._mNickName="",this.mMoney=0,this._mPlayerUid=0,this._mCannonId=0,this._mPlayerServerIndex=0,this._mPlayerClientIndex=0,Log.log("fishPlayer.playerExit.updateInfo,",this.mMoney,",nick=",this._mNickName),this.updateInfo()},Object.defineProperty(e.prototype,"mPlayerSeaNumber",{get:function(){return this._mPlayerServerIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mPlayerClientIndex",{get:function(){return this._mPlayerClientIndex},enumerable:!0,configurable:!0}),e.prototype.refreshMaster=function(){Log.log("fishPlayer.refreshMaster.updateInfo,",this.mMoney,",nick=",this._mNickName),this._mRender.checkMaster(this._mIsMaster),this.updateInfo()},e.prototype.stopHeatEffect=function(){this._mRender.stopHeatEffect()},e.prototype.showChatMessage=function(t,e){this._mRender.showBubble(t,e)},e.prototype.updateInfo=function(){this._mRender.updateCannon(this._mCannonId),this._mRender.updateMoney(this.mMoney),this._mRender.updateName(this._mNickName),Log.log("fishPlayer.updateInfo,",this.mMoney,",nick=",this._mNickName)},e.prototype.updateCannon=function(t){this._mCannonId=t,this._mRender.updateCannon(this._mCannonId),this.updateCannonCfg()},e.prototype.updateMoney=function(t){this.mMoney;this.mMoney=t,this._mRender.updateMoney(this.mMoney)},e.prototype.getCannonCfg=function(){return this._mCurrCannonCfg},e.prototype.updateCannonCfg=function(){if(!(this._mCannonId<=0)){var e=t.FishUtil.getCannonConfigById(this._mCannonId);this._mCurrCannonCfg=e,this._mCurrBulletCost=e.gun_cost}},e.prototype.cost=function(){var e=this.fireNeedMoney(),i=this.mMoney;this.mMoney-=e,Log.log("开炮成功，原始钱",i,"减后：",this.mMoney,"已减：",i-this.mMoney,"应减钱：",e+",基础消耗=",this._mCurrBulletCost,",本场倍率：",t.FishUtil.mFishBaseMultiple),this.updateMoney(this.mMoney)},e.prototype.fireNeedMoney=function(){var e=this._mCurrBulletCost;return e*t.FishUtil.mFishBaseMultiple},e.prototype.fire=function(){this.getRender().fire()},e.prototype.getCannonId=function(){return this._mCannonId},Object.defineProperty(e.prototype,"mIsMaster",{get:function(){return this._mIsMaster},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mNickName",{get:function(){return this._mNickName},enumerable:!0,configurable:!0}),e.prototype.getBulletCost=function(){return this._mCurrBulletCost},e.prototype.getBulletId=function(){return this._mCannonId},e.prototype.getNetId=function(){return this._mCannonId},e.prototype.destroy=function(){this._mRender=void 0,this._mCurrCannonCfg=void 0},e}();t.FishPlayer=e,__reflect(e.prototype,"fishjoy.FishPlayer")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._mCurrCannonId=0,t.isShowHeart=!1,t.cali_r=67,t.level=-1,t._mCurrMaxPaoLv=1,t.isChangeByMove=!1,t.cali_step=20,t}return __extends(i,e),i.prototype.initComponent=function(t){e.prototype.initComponent.call(this,t),this.labelLevel.font="fishjoy_font_2_fnt",this.labelLevel.width=200,this.labelLevel.height=80,this.labelLevel.letterSpacing=-10,this.labelLevel.anchorOffsetX=100,this.labelLevel.anchorOffsetY=40,this.labelLevel.textAlign=egret.HorizontalAlign.CENTER,this.labelLevel.scaleX=this.labelLevel.scaleY=.3,this.initial(),this.initCannon()},i.prototype.initCannon=function(){this.mSptPaotai1.visible=!1,this._mCannonBone=new t.CannonBones,this.mSptPaotai.addChild(this._mCannonBone),this.updateCannon(0)},i.prototype.checkMaster=function(t){this.btnCannonAdd&&(this.btnCannonAdd.visible=t,this.btnCannonSub.visible=t,t&&(this.mSptPaotai.touchEnabled=!1,this.mSptPaotai.touchChildren=!1,this.mSptPaotai1.touchEnabled=!1,this.u_noneTips.touchEnabled=!1,this.labelLevel.touchEnabled=!1,this.u_gCalibration.touchChildren=!0,this.u_gCalibration.touchEnabled=!0,this.btnShowCali&&!this.btnShowCali.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.btnShowCali.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showCap,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopHeatEffect,this))),this.touchEnabled=!1,this.touchChildren=t},i.prototype.updateCannon=function(t){var e=t>0;this.checkNone(e),e&&(this._mCurrCannonId=t,this.updateCannonTxt(t),this._mCannonBone.updateId(t),this.isChangeByMove||this.changeCaliAngle(t),this.fire(),this.setChangeLimit(t))},i.prototype.updateCannonTxt=function(e){var i=t.FishUtil.getCannonConfigById(e);this.labelLevel.text=""+i.gun_cost*t.FishUtil.mFishBaseMultiple/1e4},i.prototype.checkNone=function(t){this.u_info.visible=t,this.u_render.visible=t,this.u_noneTips.visible=!t},i.prototype.scaleCoinEffect=function(){var e=this;t.SoundUtils.playCoinSound(),egret.Tween.removeTweens(this.img_icon),this.img_icon.scaleX=1,this.img_icon.scaleY=1,egret.Tween.get(this.img_icon).to({scaleX:1.2,scaleY:1.2},200).wait(200).to({scaleX:1,scaleY:1},200).call(function(){egret.Tween.removeTweens(e.img_icon)
})},i.prototype.updateName=function(t){this.nickName.text=t},i.prototype.initial=function(){this.nickName.text="",this.labelLevel.verticalAlign=egret.VerticalAlign.MIDDLE,this.bubbleGroup.visible=!1,this.bubbleText.text=""},i.prototype.updateMoney=function(t){this.labelCredit.text=""+App.CommonUtils.money2Str(t)},i.prototype.showBubble=function(e,i){this.setBubbleStyle(1,i),this.bubbleGroup.visible=!0;var o=t.TxtPack.getChatTxtByIndex(e);this.bubbleText.text=o,App.EffectUtils.showUI(this.bubbleGroup,200),R.setTimeOutOnly(this.onCleanBubble,this,2e3)},i.prototype.onCleanBubble=function(){this.bubbleGroup.visible=!1},i.prototype.showSeatBubble=function(){App.EffectUtils.stopHeartEffect(this.bubbleGroup),this.isShowHeart=!0,this.setBubbleStyle(2,0),this.bubbleGroup.visible=!0;var e=t.TxtPack.getExplainTxt("90015");this.bubbleText.text=e,App.EffectUtils.showUI(this.bubbleGroup,200),R.setTimeOutOnly(this.heartEffect,this,250)},i.prototype.heartEffect=function(){App.EffectUtils.startHeartEffect(this.bubbleGroup,400)},i.prototype.setBubbleStyle=function(t,e){1==t?(1==e||2==e?this.bubbleText.y=14.5:this.bubbleText.y=24,this.bubbleText.textAlign="left",this.bubbleText.size=15):(this.bubbleText.y=23.5,this.bubbleText.textAlign="center",this.bubbleText.size=18)},i.prototype.stopHeatEffect=function(){this.isShowHeart&&(App.EffectUtils.stopHeartEffect(this.bubbleGroup),this.onCleanBubble())},i.prototype.setChangeLimit=function(e){if(this.btnCannonAdd){this.btnCannonSub.enabled=!0,this.btnCannonAdd.enabled=!0;var i=parseInt((""+e).substr(1)),o=1>=i&&!t.FishUtil.getCannonConfigById(e-1),s=i>1&&!t.FishUtil.getCannonConfigById(e+1);o?this.btnCannonSub.enabled=!1:s&&(this.btnCannonAdd.enabled=!1)}},i.prototype.addEvent=function(){e.prototype.addEvent.call(this),this.btnCannonAdd&&(this.btnCannonAdd.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.btnCannonSub.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.btnMin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLevelMin,this),this.btnMax.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLevelMax,this),this.caliTouch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLvByCalib,this),this.caliTouch.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.changeLvOnMove,this),this.caliTouch.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.changeLvByCalib,this))},i.prototype.onTouchTap=function(e){var i=e.currentTarget==this.btnCannonAdd;(!i||this.btnCannonAdd.enabled)&&(i||this.btnCannonSub.enabled)&&(t.SoundUtils.playplusSound(),this.applyFunc(t.FishConst.Player_Change_Cannon,{isAddStr:i,levels:-1}))},i.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this.btnCannonAdd&&(this.btnCannonAdd.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.btnCannonSub.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.btnShowCali.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showCap,this),this.btnMin.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLevelMin,this),this.btnMax.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLevelMax,this),this.caliTouch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLvByCalib,this),this.caliTouch.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.changeLvOnMove,this),this.caliTouch.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.changeLvByCalib,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.stopHeatEffect,this))},i.prototype.updateCalibration=function(t){if(this.u_gCalibration){var e=t,i=App.MathUtils.getRadian(e),o=Math.cos(i)*this.cali_r+this.lightBg.x,s=Math.sin(i)*this.cali_r+this.lightBg.y;this.u_Calib.x=o,this.u_Calib.y=s,this.u_Calib.rotation=e+90}},i.prototype.setBowAngle=function(t){this.mSptPaotai.rotation=t+90,this.isTopSeat?this.labelLevel.rotation=this.mSptPaotai.rotation-180:this.labelLevel.rotation=this.mSptPaotai.rotation},i.prototype.fire=function(){this._mCannonBone.play()},i.prototype.update=function(){},i.prototype.showCap=function(t){void 0===t&&(t=null),this.stopHeatEffect()},i.prototype.initCapData=function(){var t=this.getMax();this._mCurrMaxPaoLv=parseInt((""+t).substr(1)),this.cali_step=180/(this._mCurrMaxPaoLv-1)},i.prototype.getMax=function(){for(var e=this._mCurrCannonId;;){var i=t.FishUtil.getCannonConfigById(e);if(!i)break;e++}return e-1},i.prototype.tweenComplete=function(){this.u_gCalibration.visible=!this.u_gCalibration.visible},i.prototype.changeLvByCalib=function(e){this.changeLvOnMove(e),this.applyFunc(t.FishConst.Player_Change_Cannon,{isAddStr:!1,levels:this.level})},i.prototype.changeLvOnMove=function(t){this.isChangeByMove=!0;var e=App.MathUtils.getAngle2(this.lightBg.x,this.lightBg.y,t.localX,t.localY);-170>=e&&(e=-170),e>=-11&&(e=-11);var i=App.MathUtils.getRadian(e),o=Math.cos(i)*this.cali_r+this.lightBg.x,s=Math.sin(i)*this.cali_r+this.lightBg.y;this.u_Calib.x=o,this.u_Calib.y=s,this.u_Calib.rotation=e+90+this.cali_step,this.level=1e3*Math.floor(this._mCurrCannonId/1e3)+this.getLevelByAngle(e),this.updateCannonTxt(this.level)},i.prototype.changeLevelMin=function(e){this.isChangeByMove=!1;var i=1e3*Math.floor(this._mCurrCannonId/1e3)+1;this.applyFunc(t.FishConst.Player_Change_Cannon,{isAddStr:!1,levels:i})},i.prototype.changeLevelMax=function(e){this.isChangeByMove=!1;var i=1e3*Math.floor(this._mCurrCannonId/1e3)+this._mCurrMaxPaoLv;this.applyFunc(t.FishConst.Player_Change_Cannon,{isAddStr:!1,levels:i})},i.prototype.changeCaliAngle=function(t){var e=parseInt((""+t).substr(1));Log.log("换炮返回：levelss="+e);var i=e*this.cali_step+180;i-=this.cali_step,this.updateCalibration(i)},i.prototype.getLevelByAngle=function(t){var e=-1,i=Math.abs(t);return e=i/this.cali_step,e=this._mCurrMaxPaoLv-Math.floor(e)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.btnCannonAdd.filters=void 0,this.btnCannonSub.filters=void 0,this.isTopSeat=!1},i}(BaseEuiComponent);t.FishPlayerRender=e,__reflect(e.prototype,"fishjoy.FishPlayerRender")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){return t.call(this,null)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},e.prototype.updateId=function(t){this.initDBRes(t),this.alpha=.5,this.armature=this.createArmature("Armature",t,e._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(t){void 0===t&&(t=1),this.armature.play(e.Animation,999999,t)},e.prototype.dead=function(){this.armature.play(e.AnimationDead,2)},e.prototype.clean=function(){t.prototype.clean.call(this),this.rotation=0,this.scaleX=1,this.scaleY=1},e.prototype.armaturePlayEnd=function(t){t.animationName==e.AnimationDead&&egret.Tween.get(this).to({alpha:0},500).call(function(){this._mCallBack&&this._mCallBack.call(this._mThisobj)}.bind(this))},e.prototype.destroy=function(){t.prototype.destroy.call(this),egret.Tween.removeTweens(this),this._mCallBack=void 0,this._mThisobj=void 0,this.armature=void 0},e.Animation="move",e.AnimationDead="dead",e._mActionList=[e.Animation,e.AnimationDead],e}(base.BaseGameObject);t.FishShandowBones=e,__reflect(e.prototype,"fishjoy.FishShandowBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this,null)||this;return e._currState="",e}return __extends(e,t),e.prototype.getState=function(){return this._currState},e.prototype.setState=function(t){this._currState=t},e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.updateId=function(t){this.initDBRes(t),this.armature=this.createArmature("Armature",t,e._mActionList)},e.prototype.clean=function(){t.prototype.clean.call(this),this.stop()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.armature=void 0},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(){this.armature.play(e.Animation,3)},e.prototype.stop=function(){this.armature.stop()},e.Animation="move",e._mActionList=[e.Animation],e}(base.BaseGameObject);t.GoldBones=e,__reflect(e.prototype,"fishjoy.GoldBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t,i){var o=e.call(this,t,i)||this;return o.init(),o}return __extends(i,e),i.create=function(t,e){return ObjectPool.pop("fishjoy.GoldEff",t,e)},i.release=function(t){t.clean(),ObjectPool.push(t)},i.getGold=function(){var e=i.GoldList.pop();return e||(e=new t.GoldBones),e},i.relGold=function(t){i.GoldList.push(t)},i.prototype.init=function(){e.prototype.init.call(this),this._mGoldList=[],this._mGoldLabel=new eui.BitmapLabel},i.prototype.setMaster=function(t){this._mRender&&(this._mRender.filters=t?null:[ColorFilters.FilterGray])},i.prototype.createGoldList=function(e,o,s){for(var n,r=22*Math.min(o,5),h=o>5?30:0,a=0;o>a;a++){n=i.getGold(),n.updateId("gold_effect"),this._mGoldList.push(n),this._mRender.addChild(n),n.play(),n.m_i=a+1,n.visible=!1,n.x=this.getFixX(2*r)+45*Math.floor(a%5)-r,n.y=this.fixY+66*Math.floor(a/5)-h;var l=App.MathUtils.getDistance(this.x,this.y,e.x,e.y),p=egret.Tween.get(n);p.wait(i.GoldWaitTime+200+a*App.MathUtils.randomInt(15,30)).to({visible:!0}).to({scaleX:.8,scaleY:1.1,y:n.y-80},300,egret.Ease.sineOut).to({scaleX:1.1,scaleY:.8,y:n.y},180).to({scaleX:.8,scaleY:1.1,y:n.y-30},180).to({scaleX:1,scaleY:1,y:n.y},120).wait(100*Math.floor(a%5)).to({x:e.x,y:e.y},l/1.5).call(function(e){App.MessageCenter.dispatch(t.FishConst.scale_coin_effect,s),e.visible=!1}.bind(this,n))}App.TimerManager.doTimer(3e3,1,this.remove,this)},i.prototype.remove=function(){this.setDead()},i.prototype.createLabel=function(t,e){var o=this._mGoldLabel;e>0?(this._mGoldLabel.font="fishjoy_baoji_fnt",this._mGoldLabel.letterSpacing=-10,o.text=t/1e4+"x"+e):(this._mGoldLabel.font="fishjoy_font_2_fnt",this._mGoldLabel.letterSpacing=-10,o.text=""+t/1e4),o.x=this.getFixX(o.width),o.y=this.fixY,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.scaleX=o.scaleY=o.alpha=0,o.visible=!0,this._mRender.addChild(o),egret.Tween.get(o).to({scaleX:1,scaleY:1,alpha:1},300,egret.Ease.backOut).wait(i.GoldWaitTime).call(function(t){t.visible=!1}.bind(this,o)),"+0"==o.text&&egret.error("金币=====+0",t)},i.prototype.initRenders=function(){this._mRender.parent||this._mParent.addChild(this._mRender)},i.prototype.refreshGold=function(t,i,o,s,n){void 0===n&&(n=0),e.prototype.refresh.call(this,0),this.initRenders(),this.createGoldList(t,s,o),this.createLabel(i,n)},i.prototype.setPos=function(t,e){this.x=t,this.y=e},i.prototype.getFixX=function(t){var e=t/2,i=this.x;return i+e>GameBase.GameWidth?i=GameBase.GameWidth-e:0>i-e&&(i=e),i},Object.defineProperty(i.prototype,"fixY",{get:function(){var t=this.y;return 120>t&&(t=120),t>500&&(t=500),t},enumerable:!0,configurable:!0}),i.prototype.clean=function(){e.prototype.clean.call(this);for(var t=this._mGoldList;t.length;){var o=t.pop();o.clean(),o.stop(),egret.Tween.removeTweens(o),i.relGold(o)}this._mRender.filters=null},i.prototype.destroy=function(){e.prototype.destroy.call(this),App.TimerManager.removeAll(this);for(var t=i.GoldList;t.length;){var o=t.pop();egret.Tween.removeTweens(o),o.destroy()}this._mGoldLabel&&(this._mGoldLabel.parent&&this._mGoldLabel.parent.removeChild(this._mGoldLabel),this._mGoldLabel=void 0),this._mGoldList=void 0},i.GoldList=[],i.GoldWaitTime=800,i}(t.FishJoyBase);t.GoldEff=e,__reflect(e.prototype,"fishjoy.GoldEff")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t,i){var o=e.call(this,t,i)||this;return o.init(),o}return __extends(i,e),i.create=function(t,e){return ObjectPool.pop("fishjoy.GoldSpecial",t,e)},i.release=function(t){t.clean(),ObjectPool.push(t)},i.prototype.init=function(){e.prototype.init.call(this),this._mGoldBone=new t.GoldSpecialBone,this._mGoldLabel=new eui.BitmapLabel,this._mGoldLabel.font="fishjoy_font_2_fnt",this._mGoldLabel.letterSpacing=-10,this._mGoldLabel.width=200,this._mGoldLabel.height=50,this._mGoldLabel.textAlign=egret.HorizontalAlign.CENTER,this._mGoldLabel.anchorOffsetX=100,this._mGoldLabel.anchorOffsetY=25},i.prototype.updateBone=function(t){this._mRender.addChild(this._mGoldBone),this._mGoldBone.updateId(t),this._mGoldBone.addCallBack(this.callBack,this)},i.prototype.callBack=function(){this.setDead()},i.prototype.createLabel=function(t){var e=this._mGoldLabel;e.text=""+t/1e4,e.scaleX=e.scaleY=e.alpha=0,e.y=62,this._mRender.addChild(e)},i.prototype.initRenders=function(){this._mRender.parent||this._mParent.addChild(this._mRender)},i.prototype.refreshGold=function(t,i){e.prototype.refresh.call(this,0),this.initRenders(),this.updateBone(i),this.createLabel(t),R.setTimeOut(this.play,this,800)},i.prototype.play=function(){this._mGoldBone.play(),egret.Tween.get(this._mGoldLabel).to({scaleX:.6,scaleY:.6,alpha:1},200,egret.Ease.backOut)},i.prototype.setPos=function(t,e){this.x=t,this.y=e,this._mRender.x=t,this._mRender.y=e},i.prototype.clean=function(){e.prototype.clean.call(this),R.removeAllTimeOut(this),egret.Tween.removeTweens(this._mGoldLabel),this._mGoldBone.clean(),this._mRender.filters=null},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._mGoldBone.destroy(),this._mGoldBone=void 0},i}(t.FishJoyBase);t.GoldSpecial=e,__reflect(e.prototype,"fishjoy.GoldSpecial")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this,null)||this;return e.getAni="",e.stayAni="",e._mId=0,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.updateId=function(t){this.visible=!1,this._mId=t,e.__Name[""+this._mId]||(egret.error("没有这个鱼的动画 type：",this._mId),this._mId=5002),this.getAni=e.__Name[""+this._mId].get,this.stayAni=e.__Name[""+this._mId].stay;var i="goldSpecial";this.initDBRes(i),this.armature=this.createArmature("badge-anim",i,e._mActionList),this.armature.addCompleteCallFunc(this.callBack,this)},e.prototype.callBack=function(t){t.animationName==this.getAni?this.armature.play(this.stayAni,20):this._mCallBack&&this._mCallBack.call(this._mThisObj)},e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.play=function(){this.visible=!0,this.armature.play(this.getAni,1)},e.prototype.addCallBack=function(t,e){this._mCallBack=t,this._mThisObj=e},e.prototype.stop=function(){this.armature.stop()},e.prototype.clean=function(){t.prototype.clean.call(this),this.stop()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.armature=void 0},e.resName="goldSpecial",e.boneName="badge-anim",e._mActionList=["badge dragon","badge girl","badge fish","badge dragon1","badge girl1","badge fish1"],e.__Name={5003:{get:"badge dragon",stay:"badge dragon1"},5002:{get:"badge girl",stay:"badge girl1"},5001:{get:"badge fish",stay:"badge fish1"}},e}(base.BaseGameObject);t.GoldSpecialBone=e,__reflect(e.prototype,"fishjoy.GoldSpecialBone")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t,i){var o=e.call(this,t,i)||this;return o._mNetBones=null,o.init(),o}return __extends(i,e),i.create=function(t,e){return ObjectPool.pop("fishjoy.Net",t,e)},i.release=function(t){t.clean(),ObjectPool.push(t)},i.prototype.init=function(){e.prototype.init.call(this),this._mNetBones=new t.NetBones},i.prototype.initRenders=function(){this._mRender.parent||(this._mParent.addChild(this._mRender),this._mRender.addChild(this._mNetBones)),this._mNetBones.updateId(this.mId)},i.prototype.refreshNet=function(t){e.prototype.refresh.call(this,t),this.initRenders(),this.play()},i.prototype.play=function(){this._mNetBones.play(),this._mNetBones.initPlayedEndCallBack(this.playEnd,this)},i.prototype.playEnd=function(){this.setDead()},i.prototype.setPos=function(t,e){this._mRender.x=this.x=t,this._mRender.y=this.y=e},i.prototype.clean=function(){e.prototype.clean.call(this),this._mNetBones.clean()},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._mNetBones.destroy(),this._mNetBones=void 0},i}(t.FishJoyBase);t.Net=e,__reflect(e.prototype,"fishjoy.Net")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){return e.call(this,null)||this}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this)},i.prototype.updateId=function(e){var o=t.FishUtil.getCannonConfigById(e),s=o.bullet_net_assets;this.initDBRes(s),this.armature=this.createArmature("Armature",s,i._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},i.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},i.prototype.setPosition=function(t,e){this.x=t,this.y=e},i.prototype.play=function(){this.armature.play(i.Animation,1)},i.prototype.armaturePlayEnd=function(t){t.animationName==i.Animation&&this._mCallBack&&this._mCallBack.call(this._mThisobj)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._mCallBack=void 0,this._mThisobj=void 0,this.armature=void 0},i.Animation="open",i._mActionList=[i.Animation],i}(base.BaseGameObject);t.NetBones=e,__reflect(e.prototype,"fishjoy.NetBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){for(var t=[],e=1;27>=e;e++){var i=10>e?"0"+e:""+e;t.push("shui00"+i+"_jpg")}this.initMc(t,10),this.blendMode=egret.BlendMode.ADD},e}(SpriteMovieClip);t.WaterMC=e,__reflect(e.prototype,"fishjoy.WaterMC")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.init=function(){this.touchEnabled=!1,this.touchChildren=!1,this._mPartcile=new BaseParticleObj,this._mPartcile.init("fish_bulb"),this.addChild(this._mPartcile),this._mTideWave=new BaseParticleObj,this._mTideWave.init("transPartical"),this._mTideWave.y=70,this.addChild(this._mTideWave),this._mTideWave.visible=!1,this._mTxtTip=new eui.Image,this._mTxtTip.texture=RES.getRes("grabfish_ui_text01_png"),this._mTxtTip.anchorOffsetX=this._mTxtTip.width/2,this._mTxtTip.anchorOffsetY=this._mTxtTip.height,this._mTxtTip.x=GameBase.GameWidth/2,this._mTxtTip.y=GameBase.GameHeight-300,this.addChild(this._mTxtTip)},i.prototype.play=function(t){this._directionss=t,this.visible=!0,this.playTxtEff()},i.prototype.playTxtEff=function(){this._mTxtTip.visible=!0,this._mTxtTip.alpha=1,this._mTxtTip.scaleX=this._mTxtTip.scaleY=0,egret.Tween.removeTweens(this._mTxtTip),egret.Tween.get(this._mTxtTip).to({scaleX:1,scaleY:1},300,egret.Ease.backOut).wait(800).to({alpha:0},300).wait(500).call(function(){this._mTxtTip.visible=!1,this.playWave()}.bind(this),this)},i.prototype.playWave=function(){this.dispatchEvent(new egret.Event(i.WAVE_START)),t.SoundUtils.playWaveSound(),this._mPartcile.play(),this._mPartcile.x=-120,this._mPartcile.y=-180,this.waveParti()},i.prototype.waveParti=function(){this._mTideWave.visible=!0;var t=this._directionss;this._mTideWave.x=t>0?-300:1520,this._mTideWave.scaleX=-t,this._mTideWave.play(),this._mTideWave&&egret.Tween.removeTweens(this._mTideWave),egret.Tween.get(this._mTideWave,{onChange:this.waveMove,onChangeObj:this}).to({x:t>0?1520:-300},2200).call(this.stopWave,this)},i.prototype.waveMove=function(){var t=this._mTideWave.x;this.dispatchEvent(new egret.Event(i.WAVE_MOVE,!1,!1,t))},i.prototype.stopWave=function(){this.dispatchEvent(new egret.Event(egret.Event.COMPLETE)),this._mTideWave.stop(),this._mTideWave.visible=!1,this.visible=!1},i.prototype.destroy=function(){egret.Tween.removeTweens(this._mTxtTip),R.removeFromParent(this),this.removeChildren(),this._mTideWave.destroy(),this._mPartcile.destroy(),this._mTxtTip.texture=void 0,this._mTxtTip=void 0,this._mPartcile=void 0,this._mTideWave=void 0},i.WAVE_MOVE="wave_move",i.WAVE_START="wave_start",i}(egret.DisplayObjectContainer);t.TideWave=e,__reflect(e.prototype,"fishjoy.TideWave")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.mIsShowFishHit=!1,t.CannonPosList=[[],[369,595],[751,595],[755,36],[348,36]],t.coinPosList=[[],[100,610],[900,610],[900,54],[94,54]],t.onPlayerEnterCallBack="11001",t.onPlayerLeaveCallBack="11002",t.onDistributeCallBack="11003",t.onPlayerFireCallBack="11004",t.onGameStatusCallBack="11005",t.onDeadFishsCallBack="11006",t.onTideComingPrepareCallBack="11007",t.onSwitchSceneCallBack="11008",t.onChangeGunCallBack="11009",t.onReConnetCallBack="11010",t.onBossComingCallBack="11011",t.onFishTimeSyscCallBack="11012",t.onFishUnlockCallBack="11013",t.onFishChatBack="11014",t.onOffsetFishNotify="11015",t.boLangChange="boLangChange",t.Player_Change_Cannon="Player_Change_Cannon",t.CLICKBACKROOM="ClickBackRoom",t.CLICKBACKLOBBY="ClickBackLobby",t.PLAYER_CHAT="playerChat",t.scale_coin_effect="scale_coin_effect",t.hide_master_paopao="hide_master_paopao",t.fish_move_dead="fish_move_dead",t}();t.FishConst=e,__reflect(e.prototype,"fishjoy.FishConst")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e;!function(t){t[t.ScFishPlayerEnterNotifyType=11201]="ScFishPlayerEnterNotifyType",t[t.ScFishPlayerLeaveNotifyType=11202]="ScFishPlayerLeaveNotifyType",t[t.CsFishPlayerReadyReqType=11203]="CsFishPlayerReadyReqType",t[t.ScFishDistributeNotifyType=11204]="ScFishDistributeNotifyType",t[t.CsFishPlayerFireReqType=11205]="CsFishPlayerFireReqType",t[t.ScFishFireNotifyType=11206]="ScFishFireNotifyType",t[t.ScFishGameStatusNotifyType=11207]="ScFishGameStatusNotifyType",t[t.CsFishCollidedNotifyType=11208]="CsFishCollidedNotifyType",t[t.ScFishDeadFishesNotifyType=11209]="ScFishDeadFishesNotifyType",t[t.ScFishSwitchSceneNotifyType=11210]="ScFishSwitchSceneNotifyType",t[t.CsFishChangeGunReqType=11211]="CsFishChangeGunReqType",t[t.ScFishChangeGunNotifyType=11212]="ScFishChangeGunNotifyType",t[t.ScFishBossComingNotifyType=11213]="ScFishBossComingNotifyType",t[t.CsFishChatReqType=11214]="CsFishChatReqType",t[t.ScFishChatNotifyType=11215]="ScFishChatNotifyType",t[t.ScFishOffsetGroupNotifyType=11216]="ScFishOffsetGroupNotifyType"}(e=t.ProxyConst||(t.ProxyConst={}))}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e;!function(t){t[t.Base=1100]="Base",t[t.Guide=1102]="Guide",t[t.Setting=1103]="Setting",t[t.ChangeCanon=1104]="ChangeCanon",t[t.help=1105]="help"}(e=t.ViewsConst||(t.ViewsConst={}))}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._mBulletList=null,i._mBulletCount=0,i}return __extends(i,e),i.prototype.inits=function(){e.prototype.inits.call(this),this._mBulletList=[]},i.prototype.createBullet=function(e,i,o,s,n,r,h,a,l,p){if(!(GameBase.getCurrServerTime()-p>6e5)){var c=t.Bullet.create(i,s);c.setRotation(h),c.refresh(i),c.setServerId(e),c.setPos(n,r),c.updateNetId(o),c.setFish(a),c.setMaster(l),c.setTime(p),this._mBulletList.push(c),l&&this._mBulletCount++}},i.prototype.removeBullet=function(t){for(var e=this._mBulletList.length-1;e>=0;e--){var i=this._mBulletList[e];if(i.getServerId()==t)return void i.setDead()}},Object.defineProperty(i.prototype,"isMasterBulletFull",{get:function(){return this._mBulletCount>=30?!0:!1},enumerable:!0,configurable:!0}),i.prototype.getBulletByIndex=function(t){for(var e=this._mBulletList,i=e.length-1;i>=0;i--){var o=e[i];if(o.getServerId()==t)return o}return null},i.prototype.cleanBulletFish=function(t){for(var e=this._mBulletList,i=e.length-1;i>=0;i--){var o=e[i];o.getLockFishSId()==t&&o.setFish(void 0)}},i.prototype.gotoHitFish=function(t){for(var e=this._mBulletList,i=e.length-1;i>=0;i--){var o=e[i];o.mIsMaster&&o.isLive&&o.setFish(t)}},i.prototype.update=function(e){for(var i=this._mBulletList,o=i.length-1;o>=0;o--){var s=i[o];s.isDead()?(this._mBulletList.splice(o,1),s.mIsMaster&&(this._mBulletCount-=1),t.Bullet.release(s)):s.update(e)}},i.prototype.getList=function(){return this._mBulletList},i.prototype.registers=function(){},i.prototype.addListeners=function(){},i.prototype.removeListeners=function(){},i.prototype.clean=function(){for(var e=this._mBulletList;e.length;){var i=e.pop();t.Bullet.release(i)}},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=this._mBulletList;t.length;){var i=t.pop();i.destroy()}this._mBulletList=void 0,ObjectPool.clearClass("fishjoy.Bullet","destroy")},i}(base.GameSeparateCtrl);t.BulletController=e,__reflect(e.prototype,"fishjoy.BulletController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._mPathList={},i._mIsMirror=!1,i.__ct=0,i._mTideSpeed=0,i._mTideDirection=0,i._mTideDuration=0,i._mTideStartTime=0,i._mTideId=0,i._mTideInited=!1,i._mTideRunning=!1,i}return __extends(i,e),i.prototype.inits=function(){e.prototype.inits.call(this),this._mFishList=[]},i.prototype.createFish=function(e,i,o,s,n,r,h,a){var l,p=t.Fish.create(i,s);if(!h){if(!(o>0))return void Log.error("路径配置 pathId：",o);l=a?this.getOffsetPath(o,a):this.getPath(o)}return p.setTideShandowGroup(n),p.setServerId(e),p.refreshFish(l),p.setTime(r),this._mFishList.push(p),p},i.prototype.getPath=function(t){var e=this._mPathList["fish_path"+t];if(e)return e;var i=RES.getRes("fish_path"+t+"_json");if(!i||!i.data||i.data.length<=0)return void Log.warn("没有这个路径配置：",t);var o=i.data;e={};for(var s=0,n=o.length;n>s;s++)e["data_"+s]=App.CommonUtils.copyDataHandler(o[s]);if(this._mIsMirror)for(var r in e)e[r].y=GameBase.GameHeight-e[r].y;return this._mPathList["fish_path"+t]=e,e},i.prototype.getOffsetPath=function(t,e){var i=this._mPathList["fish_path"+t],o=RES.getRes("fish_path"+t+"_json");if(!o||!o.data||o.data.length<=0)return void Log.warn("没有这个路径配置：",t);var s=o.data;i={};for(var n=0,r=s.length;r>n;n++)i["data_"+n]=App.CommonUtils.copyDataHandler(s[n]);for(var h in i)i[h].x=i[h].x+e.x,i[h].y=i[h].y+e.y;if(this._mIsMirror)for(var h in i)i[h].y=GameBase.GameHeight-i[h].y;return i},i.prototype.setMirror=function(t){this._mIsMirror=t},i.prototype.removeFish=function(t){var e=this.getFish(t);e&&e.setDead()},i.prototype.getFish=function(t){for(var e=this._mFishList,i=e.length-1;i>=0;i--){var o=e[i];if(o.getServerId()==t)return o}return null},i.prototype.getTouchFish=function(t,e){for(var i=this._mFishList,o=i.length-1;o>=0;o--){var s=i[o];if(s.hitTouch(t,e))return s}return null},i.prototype.getHightFish=function(){for(var t,e=this._mFishList,i=0,o=0,s=e.length-1;s>=o;o++){var n=e[o];!n.isOut()&&n.isLive&&n.mId>i&&(i=n.mId,t=n)}return t},i.prototype.clearArmIcon=function(){for(var t=this._mFishList,e=t.length,i=0;e>i;i++){var o=t[i];o.cleanLock()}},i.prototype.update=function(e){for(var i=this.dt(e),o=this._mFishList,s=o.length-1;s>=0;s--){var n=o[s];n.isDead()?(o.splice(s,1),t.Fish.release(n)):n.update(e)}this.updateTide(i)},i.prototype.dt=function(t){var e=this.__ct-t;return e=e>0?e:16,this.__ct=t,e},i.prototype.runAway=function(){for(var t=this._mFishList,e=t.length-1;e>=0;e--){var i=t[e];i&&i.isLive&&i.runAway()}},i.prototype.refreshHitRect=function(){for(var t=this._mFishList,e=t.length-1;e>=0;e--)t[e].refreshHitRect()},i.prototype.clean=function(){for(var e=this._mFishList;e.length;){var i=e.pop();t.Fish.release(i)}},Object.defineProperty(i.prototype,"gameController",{get:function(){return this.getController()},enumerable:!0,configurable:!0}),i.prototype.getList=function(){return this._mFishList},i.prototype.destroy=function(){this.cleanTide(),e.prototype.destroy.call(this);for(var i=this._mFishList;i.length;)this._mFishList.pop().destroy();this._mFishList=void 0,this._mPathList=void 0,t.Fish.clearPool(),ObjectPool.clearClass("fishjoy.Fish","destroy")},i.prototype.tideInitData=function(t){var e=t;this._mTideSpeed=e.speed/1e4,this._mTideDuration=e.duration,this._mTideDirection=e.direction,this._mTideInitFishList=[].concat(e.list),this._mTideInitFishList.sort(function(t,e){return Math.abs(t.x)==Math.abs(e.x)?Math.abs(t.y)-Math.abs(e.y):Math.abs(e.x)-Math.abs(t.x)})},i.prototype.onTideInitFish=function(){var t=this._mTideInitFishList;if(t&&!(t.length<=0)){var e=this.gameController.gameView,i=e.mFishGroupTide,o=e.mShandowGroup,s=this._mTideDirection,n=i.x;o.x=i.x;for(var r=egret.getTimer(),h=t.length-1;h>=0;h--){var a=t[h],l=n+a.x;if(1==s&&l>1380||-1==s&&-260>l||!this.isFishLiveTide(a.fish_id))t.splice(h,1);else if(l>=-260&&1380>=l){t.splice(h,1);var p=a.fish_type,c=this.createFish(a.fish_id,p,-1,e.getFishLay(p,!0),o,0,!0),u=this._mIsMirror?GameBase.GameHeight-a.y:a.y;if(c.setPos(a.x,u),c.setTideGroup(i),c.setDirection(s),egret.getTimer()-r>5)break}}t.length<=0&&Log.warn("----------------------- 鱼潮刷新完成完成！ -----------------------")}},i.prototype.isFishLiveTide=function(t){return!this._mTideFishs||this._mTideFishs&&1==this._mTideFishs[""+t]},i.prototype.tideGo=function(e,i,o){t.SoundUtils.playTideBGM(),this.cleanTide(),this._mTideStartTime=e,this._mTideId=i,this.pTideFishs(o),this._mTideInited=!0,App.TimerManager.doFrame(1,999999,this.tideStart,this)},i.prototype.pTideFishs=function(t){if(t){this._mTideFishs={};for(var e=t.length-1;e>=0;e--){var i=t[e];this._mTideFishs[""+i.fish_id]=1}}},i.prototype.tideStart=function(){if(!(GameBase.getCurrServerTime()-this._mTideStartTime<0)){App.TimerManager.remove(this.tideStart,this);var t=RES.getRes("fish_tide"+this._mTideId+"_json");if(!t)return void Log.error("没有鱼潮配置：",this._mTideId);this.tideInitData(t),this.synchronize(),this.onTideInitFish(),this._mTideRunning=!0}},i.prototype.synchronize=function(){var t=GameBase.getCurrServerTime()-this._mTideStartTime,e=Math.floor(t/16);if(this.gameController&&this.gameController.gameView){var i=this.gameController.gameView,o=i.mFishGroupTide,s=i.mShandowGroup,n=1==this._mTideDirection?0:GameBase.GameWidth;n+=this._mTideDirection*this._mTideSpeed*e,s.x=o.x=n}},i.prototype.updateTide=function(e){if(this._mTideRunning){this.onTideInitFish();var i=GameBase.getCurrServerTime();return i-this._mTideStartTime>1e3*this._mTideDuration?(this.cleanTide(),this._mTideRunning=!1,t.SoundUtils.playBGM(),void Log.log("----------------------- 鱼潮结束！ -----------------------")):void this.synchronize()}},Object.defineProperty(i.prototype,"mIsTideRunning",{get:function(){return this._mTideRunning||this._mTideInited},enumerable:!0,configurable:!0}),i.prototype.cleanTideFish=function(){for(var t=this._mFishList,e=t.length-1;e>=0;e--){var i=t[e];i.mIsTideFish&&i.setDead()}},i.prototype.cleanTide=function(){this.cleanTideFish();var t=this.gameController.gameView;t.mFishGroupTide.removeChildren(),t.mShandowGroup.removeChildren(),t.mShandowGroup.x=0,t.mFishGroupTide.x=0,this._mTideRunning=!1,this._mTideSpeed=0,this._mTideDuration=0,this._mTideDirection=0,this._mTideStartTime=0,this._mTideInited=!1,this._mTideFishs=void 0,this._mTideInitFishList=void 0},i}(base.GameSeparateCtrl);t.FishController=e,__reflect(e.prototype,"fishjoy.FishController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e;!function(e){var i=function(){function e(){}return e.prototype.getVersion=function(){return"v1.0.0"},e.prototype.reconstruction=function(t){var e=base.getController(t);e&&e.onReconstruction()},e.prototype.create=function(e){e==ControllerConst.Room?App.ControllerManager.register(ControllerConst.Room,new t.RoomController):e==ControllerConst.Game?App.ControllerManager.register(ControllerConst.Game,new t.GameController):e==ControllerConst.Desk;var i=base.getController(e);i&&i.onCreate()},e.prototype.initialize=function(t){t==ControllerConst.Game&&App.setScaleModeSpecial();var e=base.getController(t);e&&e.onInit()},e.prototype.destroy=function(t){App.setScaleModeNormal()},e}();e.fishjoy=i,__reflect(i.prototype,"fishjoy.Entrance.fishjoy",["base.IEntranceface"])}(e=t.Entrance||(t.Entrance={}))}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._mProxy=null,t._view=null,t._guideView=null,t._settingView=null,t._changeCannonView=null,t._helpView=null,t._mCtrlBullet=null,t._mCtrlFishPlayer=null,t._mCtrlFish=null,t._mCtrlGoldEff=null,t._mCtrlNet=null,t._mCtrlFishHitBulb=null,t._bgManager=null,t._mIsMirror=!1,t._mIsDataInited=!1,t._mCurrTime=0,t._tempServer=0,t._tempGoldServerId=1,t._tempNetServerId=1,t._mInitArrFish=[],t._mInitArrBullet=[],t._mCountMove=0,t._mIsTouchShoot=!1,t._mCurrAShootAngle=-90,t._mIsAutoShoot=!1,t._isLockFish=!1,t._mLockFishId=0,t._mInitArrFish2=[],t._mFishCreateListId=[],t._mFishCreateList=[],t.showBullTipsCount=0,t.showBullTipsGapTim=0,t.testBgID=501,t.checkCount=0,t
}return __extends(i,e),i.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.inits(),this.addListeners(),this._mIsDataInited=!1,this._mFishDeadCache=[]},i.prototype.onInit=function(){e.prototype.onInit.call(this),this.registers(),this.inited()},i.prototype.fishPrecreate=function(){var t=RES.getRes("fish_json");for(var e in t){var i=e.split("_")[1],o=parseInt(i);!o||4e3>o||this._mFishCreateListId.push(o)}App.TimerManager.doFrame(1,999,this.onFishCreated,this)},i.prototype.onFishCreated=function(){if(this._mFishCreateListId.length<=0)return App.TimerManager.remove(this.onFishCreated,this),void R.setTimeOutOnly(this.onFishCreatedRelease,this,200);var e=this._mFishCreateListId.pop(),i=t.Fish.create(e,LayerManager.Game_Bg);i.setTideShandowGroup(LayerManager.Game_Bg),i.refreshFish(null,-500,-200),this._mFishCreateList.push(i)},i.prototype.onFishCreatedRelease=function(){for(var e=this._mFishCreateList;e.length>0;)t.Fish.release(e.pop())},i.prototype.inited=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.TxtPack.parsTxt()];case 1:return e.sent(),[4,t.FishUtil.parseFishCfg()];case 2:return e.sent(),[4,t.FishUtil.parseFishTideCfg()];case 3:return e.sent(),[4,t.BgConfig.parsBgConfig()];case 4:return e.sent(),this.gameInit(),this._bgManager.inits(this._view),this._mCurrTime=GameBase.getCurrServerTime(),App.TimerManager.doFrame(1,0,this.update,this),t.SoundUtils.playBGM(),t.SoundUtils.playSwitchPao(),this.onPlayerReady(),[2]}})})},i.prototype.onReconstruction=function(){e.prototype.onReconstruction.call(this),Log.log("场景中掉线重回..."),this.cleanAll(),this._mCurrTime=GameBase.getCurrServerTime(),App.TimerManager.doFrame(1,0,this.update,this),this.onPlayerReady()},i.prototype.cleanAll=function(){Log.log("清场"),this._mCtrlFish.clean(),this._mCtrlBullet.clean(),this._mCtrlNet.clean(),this._mCtrlGoldEff.clean(),this._mCtrlFishHitBulb.clean()},i.prototype.inits=function(){e.prototype.inits.call(this),this._mCtrlFish=new t.FishController(this),this._mCtrlBullet=new t.BulletController(this),this._mCtrlGoldEff=new t.GoldEffController(this),this._mCtrlNet=new t.NetController(this),this._mCtrlFishPlayer=new t.FishPlayerController(this),this._mCtrlFishHitBulb=new t.HitBulbController(this),this._mCtrlBullet.inits(),this._mCtrlFishPlayer.inits(),this._mCtrlFish.inits(),this._mCtrlGoldEff.inits(),this._mCtrlNet.inits(),this._mCtrlFishHitBulb.inits(),this._model=new t.GameModel(this),this._mProxy=new t.GameProxy(this,this.getModel()),this._view=new t.GameView(this),this._guideView=new t.GuideView(this),this._settingView=new t.SettingView(this),this._changeCannonView=new t.ChangeCannonView(this),this._helpView=new t.HelpView(this),this._bgManager=new t.BgManagers},i.prototype.onPlayerReady=function(){var t={client_tick:this._mCurrTime};this._mProxy.reqPlayerReady(t)},i.prototype.sendFire=function(e,i,o){Log.log("客户端发送开炮请求：bulletID=",e,",fishID=",o,",this.lockFishID=",this._mLockFishId),this._mProxy.reqPlayerFire(e,this._mIsMirror?t.FishUtil.getMirrorAngle(i):i,o)},i.prototype.checkBulletFull=function(){var t=!1;if(this._mCtrlBullet.isMasterBulletFull){this.showBullTipsCount++;var e=egret.getTimer();return(1==this.showBullTipsCount||e-this.showBullTipsGapTim>2e3)&&(App.ScrollTxtTips.showTip("炮弹已达上限，请休息片刻"),this.showBullTipsGapTim=egret.getTimer()),t=!0}return t},i.prototype.onClickCard=function(t){Log.log(t)},i.prototype.registers=function(){e.prototype.registers.call(this),this._mCtrlBullet.registers(),this._mCtrlFishPlayer.registers(),this._mCtrlFish.registers(),this._mCtrlGoldEff.registers(),this._mCtrlNet.registers(),this._mCtrlFishHitBulb.registers(),App.ViewManager.register(t.ViewsConst.Base,this._view),App.ViewManager.register(t.ViewsConst.Guide,this._guideView),App.ViewManager.register(t.ViewsConst.Setting,this._settingView),App.ViewManager.register(t.ViewsConst.ChangeCanon,this._changeCannonView),App.ViewManager.register(t.ViewsConst.help,this._helpView),this.registerRecharge(),this.registerRedpacket(),this.registerFunc("onTouchBegin",this.onTouchBegin,this),this.registerFunc("onTouchEnd",this.onTouchEnd,this),this.registerFunc("onTouchMove",this.onTouchMove,this),this.registerFunc("onBtnYu",this.onBtnYu,this),this.registerFunc("onAutoShoot",this.onClickAutoShoot,this),this.registerFunc("onLockFish",this.lockFish,this),this.registerFunc("GuideClickFunc",this.onGuideClickFunc,this),this.registerFunc("SettingClickFunc",this.onSettingClickFunc,this),this.registerFunc("ChangeCannonClickFunc",this.onChangeCannonClickFunc,this),this.registerFunc("HelpClickFunc",this.onHelpClickFunc,this),this.registerFunc("screenshots",this.screenshots,this),this.registerFunc("changeBgPos",this.changeBgPos,this),this.registerFunc("waveEnd",this.waveEnd,this),this.registerFunc(t.FishConst.hide_master_paopao,this.hideMasterPaopao,this),this.registerFunc("confirmShowRecharge",this.confirmShowRecharge,this),App.MessageCenter.addListener(t.FishConst.scale_coin_effect,this.scaleCoinEffect,this),this.registerFunc(t.FishConst.CLICKBACKROOM,this.onBack2Room,this),this.registerFunc(t.FishConst.PLAYER_CHAT,this.sendChat,this),this.registerFunc(t.FishConst.onPlayerEnterCallBack,this.onPlayerEnterCallBack,this),this.registerFunc(t.FishConst.onPlayerLeaveCallBack,this.onPlayerLeaveCallBack,this),this.registerFunc(t.FishConst.onDistributeCallBack,this.onDistributeCallBack,this),this.registerFunc(t.FishConst.onPlayerFireCallBack,this.onPlayerFireCallBack,this),this.registerFunc(t.FishConst.onGameStatusCallBack,this.onGameStatusCallBack,this),this.registerFunc(t.FishConst.onDeadFishsCallBack,this.onDeadFishsCallBack,this),this.registerFunc(t.FishConst.onSwitchSceneCallBack,this.onSwitchSceneCallBack,this),this.registerFunc(t.FishConst.onChangeGunCallBack,this.onChangeGunCallBack,this),this.registerFunc(t.FishConst.onBossComingCallBack,this.onBossComingCallBack,this),this.registerFunc(t.FishConst.onFishTimeSyscCallBack,this.onFishTimeSyscCallBack,this),this.registerFunc(t.FishConst.onFishUnlockCallBack,this.onFishUnlockCallBack,this),this.registerFunc(t.FishConst.Player_Change_Cannon,this.onPlayerChangeCannon,this),this.registerFunc(t.FishConst.onFishChatBack,this.onChatNotify,this),this.registerFunc(t.FishConst.onOffsetFishNotify,this.onOffsetFishNotify,this)},i.prototype.gameInit=function(){App.ViewManager.open(t.ViewsConst.Base);for(var e=1;4>=e;e++)this._mCtrlFishPlayer.initFishPlayerRender(e,this._view.getPlayerRender(e))},i.prototype.onGameStatusCallBack=function(t){Log.log("发送准备请求，服务器返回进场数据，玩家数据等"),this.initConfig(t),this.initPlayers(t),this.initFishsAndBullet(t),this.initTide(t),this._bgManager.setBgIndexOnEnter(t)},i.prototype.initConfig=function(e){var i=e.game_config;t.FishUtil.setFishBaseConfig(i)},i.prototype.initPlayers=function(t){var e=t.masterIndex,i=t.infoList;this.mirror(i,e),this._mIsMirror=e>2,this._mCtrlFish.setMirror(this._mIsMirror);for(var o=1;4>=o;o++){var s=i[o-1];this._mCtrlFishPlayer.getPlayer(o).initPlayerInfo(s),this._mCtrlFishPlayer.initFishPlayerRender(o,this._view.getPlayerRender(o))}this._view.setChatPos(this._mCtrlFishPlayer.masterIndex)},i.prototype.initFishsAndBullet=function(t){for(var e=t.fish_tide.next_scene,i=e>0?[]:t.current_fishes,o=0,s=i.length;s>o;o++)this._mInitArrFish.push(i[o]);for(var n=t.current_bullets,o=0,s=n.length;s>o;o++)this._mInitArrBullet.push(n[o]);var r=t.offset_group;this.parseGroupFish(r),App.TimerManager.doFrame(1,999,this.onFrameInit,this),this.onFrameInit(0)},i.prototype.parseGroupFish=function(t){for(var e=0,i=t.length;i>e;e++)this.parseSignlGroupFish(t[e])},i.prototype.parseSignlGroupFish=function(t){for(var e=t.path_id,i=t.created_at,o=t.fish_group,s=0,n=o.length;n>s;s++){var r={};r.fish_type=o[s].fish_type,r.fish_id=o[s].fish_id,r.fish_pos_index=o[s].fish_pos_index,r.elapsed=o[s].elapsed,r.path_id=e,r.created_at=i,r.offset=o[s].offset,this._mInitArrFish.push(r)}},i.prototype.onFrameInit=function(t){var e=this._mInitArrFish,i=this._mInitArrBullet;Log.log("listFish len:",e.length),Log.log("bulletList len:",i.length),this.generateFish();for(var o=egret.getTimer();e.length<=0&&i.length&&!(egret.getTimer()-o>5);)this.createBullet(i.shift(),!0);e.length<=0&&i.length<=0&&(this._mIsDataInited=!0,App.TimerManager.remove(this.onFrameInit,this),this.dataRefreshInited())},i.prototype.generateFish=function(){var t=this._mInitArrFish;if(t.length>0)for(var e=egret.getTimer();t.length&&!(egret.getTimer()-e>5);)this.createFish(t.shift())},i.prototype.mirror=function(t,e){for(var i=t.length-1;i>=0;i--){var o=t[i];this.mirrorPos(o,e)}t.sort(function(t,e){return t.client_index-e.client_index})},i.prototype.mirrorPos=function(t,e){var i=t,o=i.server_index;e>2&&(o=1==o?4:2==o?3:3==o?2:1),i.client_index=o,i.masterIndex=e},i.prototype.dataRefreshInited=function(){Log.log("--- 鱼池信息初始化完成 ---");for(var t=this._mFishDeadCache;t.length;)this.onDeadFishsCallBack(t.shift())},i.prototype.initTide=function(t){var e=t.fish_tide,i=e.next_scene;if(!(0>=i)){console.info("initTide info",e);var o=e.start_time,s=[].concat(t.current_fishes);this._mCtrlFish.runAway(),this._mCtrlFish.tideGo(o,i,s)}},i.prototype.onGuideClickFunc=function(){App.ViewManager.open(t.ViewsConst.Guide)},i.prototype.onSettingClickFunc=function(){App.ViewManager.open(t.ViewsConst.Setting)},i.prototype.onChangeCannonClickFunc=function(){App.ViewManager.open(t.ViewsConst.ChangeCanon,this._mCtrlFishPlayer.master.getCannonId())},i.prototype.onHelpClickFunc=function(){App.ViewManager.open(t.ViewsConst.help)},i.prototype.screenshots=function(){this._bgManager.screenShotBeforStart()},i.prototype.changeBgPos=function(t){Log.log("改变背景位置,",t),this._bgManager.changeBgPos(t)},i.prototype.waveEnd=function(){this._bgManager.onComplete()},i.prototype.hideMasterPaopao=function(){this._mCtrlFishPlayer.master.stopHeatEffect()},i.prototype.showRecharge=function(){App.PromTipsView.show("余额不足，是否前往充值？",function(){App.ViewManager.open(LobbyViewConst.Recharge)},null,this,!0)},i.prototype.confirmShowRecharge=function(){App.ViewManager.open(LobbyViewConst.Recharge)},i.prototype.onUserMoneyChange=function(t){Log.log("onUserMoneyChange，账户变更，钱钱=",t);var e=this._mCtrlFishPlayer.master;e.updateMoney(t.balance),this.checkCount=0},i.prototype.onBtnYu=function(){this._mCtrlFish.refreshHitRect();var t=Math.random()>.5?-1:1,e=this.testBgID;e++,e>505&&(e=501),this.testBgID=e,this._bgManager.changeBg(e,t),this._view.playTideWave(t)},i.prototype.sendChat=function(t){var e={uid:this.player.getUserId(),text_id:t};Log.log("向服务器发送聊天请求---userid:"+e.uid),this._mProxy.reqFishChat(e)},i.prototype.onChatNotify=function(t){var e=t.uid,i=t.text_id;Log.log("聊天广播：seatIndex="+e+",text="+i);var o=this._mCtrlFishPlayer.getPlayerByUID(e);o.showChatMessage(i,o.mPlayerClientIndex)},i.prototype.onBack2Room=function(){Log.log("返回房间列表"),App.PromTipsView.show("是否现在退出捕鱼游戏？",function(){App.TimerManager.removeAll(this),this._mProxy.sendLeaveGame()}.bind(this),null,this,!0)},i.prototype.onExitGame=function(){this.goBack2Room(),t.SoundUtils.playGoBackSound()},i.prototype.fire=function(e,i,o,s,n,r,h){var a=this._mCtrlFishPlayer.getPlayerPos(i),l=this._mCtrlFishPlayer.getPlayer(i);if(!l)return void egret.warn("玩家 index:",i," 不存在");h||l.updateMoney(r),Log.log("收到玩家开炮：bulletId=",e,",fishId=",s,",index=",i,",money=",r);var p;s>0&&(p=this._mCtrlFish.getFish(s),p&&(o=App.MathUtils.getAngle2(a[0],a[1],p.getX(),p.getY())));var c=App.MathUtils.getRadian(o),u=50*Math.cos(c)+a[0],d=50*Math.sin(c)+a[1],m=l.getBulletId(),f=l.getNetId();l.mIsMaster||this._mCtrlFishPlayer.fire(i,o,h),this._mCtrlBullet.createBullet(e,m,f,this._view.bulletGroup,u,d,o,p,l.mIsMaster,n),l.mIsMaster&&t.SoundUtils.playFireSound()},i.prototype.onTouchBegin=function(t,e){if(this._mIsDataInited&&this._mCtrlFishPlayer&&this._mCtrlFishPlayer.master){this.hideMasterPaopao();var i=this._mCtrlFishPlayer.master.getCannonCfg();R.intervalTime(i.gun_rate,"fish_touch_shoot")&&(this._mIsAutoShoot||this.goTouchShoot(t,e),this._isLockFish&&this.setLockFishByPos(t,e),this._view.hideMenu())}},i.prototype.onTouchEnd=function(t,e){this._mIsDataInited&&(this.removeTouchFire(),this.changeAngle(t,e),this._mCtrlFishPlayer.hideCali())},i.prototype.removeAutoFire=function(){this._mIsAutoShoot=!1,this._view.resetAutoUI(),App.TimerManager.remove(this.doAutoShoot,this)},i.prototype.removeTouchFire=function(){this._mCountMove=0,this._mIsTouchShoot=!1,App.TimerManager.remove(this.onCountAutoShoot,this),App.TimerManager.remove(this.onTouchShoot,this)},i.prototype.onTouchMove=function(t,e){this._mIsDataInited&&++this._mCountMove%3==0&&this.changeAngle(t,e)},i.prototype.changeAngle=function(t,e){var i=this._mCtrlFishPlayer.masterPos,o=App.MathUtils.getAngle2(i[0],i[1],t,e);o>=-5||-175>=o||(this._mCtrlFishPlayer.masterUpdateAngle(o),this._mCurrAShootAngle=o)},i.prototype.goTouchShoot=function(t,e){if(!this.checkBulletFull()){if(this._isLockFish){var i=this._mCtrlFish.getTouchFish(t,e);if(i&&i.isLive&&!i.isOut())return}var o=this._mCtrlFishPlayer.masterPos,s=App.MathUtils.getAngle2(o[0],o[1],t,e);if(this._isLockFish)if(this._mLockFishId>0){var i=this._mCtrlFish.getFish(this._mLockFishId);if(i&&i.isLive&&!i.isOut()){if(s=App.MathUtils.getAngle2(o[0],o[1],i.getX(),i.getY()),s>=-5||-175>=s)return;this._mCtrlFishPlayer.masterFire(s),this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),s,this._mLockFishId),this._mCurrAShootAngle=s}else this.clearBulletLock(this._mLockFishId),this.setLockFish()}else{var i=this._mCtrlFish.getHightFish();if(!i){if(s>=-5||-175>=s)return;this._mCtrlFishPlayer.masterFire(s),this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),s),this._mCurrAShootAngle=s}this.setLockFish()}else{if(s>=-5||-175>=s)return;this._mCtrlFishPlayer.masterFire(s),this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),s),this._mCurrAShootAngle=s}App.TimerManager.doTimer(500,1,this.onCountAutoShoot,this)}},i.prototype.onCountAutoShoot=function(){if(this.onTouchShoot(),!this._mIsAutoShoot){this._mIsTouchShoot=!0;var t=this._mCtrlFishPlayer.master.getCannonCfg();App.TimerManager.doTimer(t.gun_rate,99999,this.onTouchShoot,this)}},i.prototype.onTouchShoot=function(){this.checkBulletFull()||(Log.log("连续射击,this._mIsTouchShoot="+this._mIsTouchShoot+",this._mLockFishId = "+this._mLockFishId),this._mIsTouchShoot&&(this._mLockFishId>0?this.fireLockFish():(this._mCtrlFishPlayer.masterFire(this._mCurrAShootAngle),this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),this._mCurrAShootAngle))))},i.prototype.fireLockFish=function(){var t=this._mCtrlFish.getFish(this._mLockFishId);if(t&&t.isLive&&!t.isOut()){var e=this._mCtrlFishPlayer.masterPos,i=App.MathUtils.getAngle2(e[0],e[1],t.getX(),t.getY());this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),i,this._mLockFishId),this._mCtrlFishPlayer.masterFire(i)}else this.clearBulletLock(this._mLockFishId),this.setLockFish()},i.prototype.onClickAutoShoot=function(t){if(this._mIsAutoShoot=t,this._mIsAutoShoot){var e=this._mCtrlFishPlayer.master.getCannonCfg();App.TimerManager.doTimer(e.gun_rate,99999,this.doAutoShoot,this),this.doAutoShoot()}else Log.log("关闭自动连续射击"),App.TimerManager.remove(this.doAutoShoot,this)},i.prototype.doAutoShoot=function(){if(!this.checkBulletFull())if(this._isLockFish){if(this._mLockFishId<=0){var t=this._mCtrlFish.getHightFish();if(!t)return this._mCtrlFishPlayer.masterFire(this._mCurrAShootAngle),void this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),this._mCurrAShootAngle);this.setLockFish(t)}this.fireLockFish()}else this._mCtrlFishPlayer.masterFire(this._mCurrAShootAngle),this.sendFire(this._mCtrlFishPlayer.master.getCannonId(),this._mCurrAShootAngle)},i.prototype.lockFish=function(t){this._isLockFish=t,this._isLockFish?this.setLockFish():this.onRemoveLockFish()},i.prototype.onRemoveLockFish=function(){var t=this._mCtrlFish.getFish(this._mLockFishId);t&&t.isLive&&t.cleanLock(),this._mLockFishId=-1},i.prototype.setLockFishByPos=function(t,e){var i=this._mCtrlFish.getTouchFish(t,e);i&&this.setLockFish(i)},i.prototype.setLockFish=function(t){var e=t?t:this._mCtrlFish.getHightFish();e&&e.isLive&&!e.isOut()&&(this._mCtrlFish.clearArmIcon(),this._mLockFishId=e.getServerId(),e.setLock(),e.playArmEffect())},i.prototype.checkMoney=function(){return!this._mIsDataInited||App.PromTipsView.parent?!1:(this.checkCount++,this.resetAutoFire(),void(this.checkCount<=1?this.showRecharge():App.ScrollTxtTips.showTip("余额不足")))},i.prototype.resetAutoFire=function(){this.removeAutoFire(),this.removeTouchFire()},i.prototype.updateTime=function(t){if(t>0)for(var e=Math.floor(t/16),i=0;e>i;i++)this.update(16)},i.prototype.update=function(t){if(t>30)return void this.updateTime(t);var e=this._mCurrTime+t;this._mCtrlBullet.update(e),this._mCtrlFish.update(e),this._mCtrlNet.update(e),this._mCtrlGoldEff.update(e),this._mCtrlFishHitBulb.update(e),this._bgManager.update();for(var i=this._mCtrlFish.getList(),o=this._mCtrlBullet.getList(),s=i.length-1;s>=0;s--){var n=i[s];if(!n.isDead()&&!n.isOver()){n.isLockedFish&&this.changeAngle(n.getX(),n.getY());for(var r=o.length-1;r>=0;r--){var h=o[r];h.isDead()||h.isOver()||h.getLockFishSId()>0&&h.getLockFishSId()!=n.getServerId()||n.hitTest(h.getHitBound())&&(n.hitAction(),h.mIsMaster&&this._mProxy.reqHitFish(n.getServerId(),n.mId,h.getServerId()),h.setDead(),this.hitBulb(h),this.showNet(h))}}}this._mCurrTime=e,this._mIsDataInited&&this.generateFish()},i.prototype.showNet=function(t){this._mCtrlNet.createNet(t.getNetId(),this._view.bulletGroup,t.x,t.y)},i.prototype.hitBulb=function(e){e.mIsMaster&&t.SoundUtils.playHitSound(),this._mCtrlFishHitBulb.createFishHitBulb(this._view.bulletGroup,e.x,e.y)},i.prototype.playShake=function(t,e){t>5e3&&5004>t&&this._view.shakeScreen()},i.prototype.showGoldEffect=function(e,i,o,s,n){var r=t.FishConst.CannonPosList[o],h=t.FishUtil.getFishGoldCoins(e.mId),a=egret.Point.create(e.getX(),e.getY()),l=t.FishConst.coinPosList[o],p=egret.Point.create(l[0],l[1]);this._mCtrlGoldEff.createBFEff(e.mId,this._view.effectGroup,a.x,a.y),e.mId>5e3&&this._mCtrlGoldEff.createGoldSpecial(e.mId,i,this._view.effectGroup,r[0],r[1]),this._mCtrlGoldEff.createGold(a,p,o,i,h,this._view.effectGroup,s,e.mId,n)},i.prototype.onPlayerEnterCallBack=function(t){Log.log("玩家加入----------");var e=t.info;this.mirrorPos(e,this._mCtrlFishPlayer.masterServerSeaNumber);var i=e.client_index;this._mCtrlFishPlayer.addPlayer(i,e)},i.prototype.onPlayerLeaveCallBack=function(t){Log.log("玩家离开----------");var e=this._mCtrlFishPlayer.getPlayerBySeaNumber(t.seat_number);e.playerExit()},i.prototype.onDistributeCallBack=function(t){this._mInitArrFish.push(t)},i.prototype.onOffsetFishNotify=function(t){Log.log("收到偏移鱼组消息"),this.parseSignlGroupFish(t)},i.prototype.createFish=function(t){var e=t,i=e.fish_type,o=e.fish_id,s=e.path_id,n=e.created_at;this._mCtrlFish.mIsTideRunning||this._mCtrlFish.createFish(o,i,s,this._view.getFishLay(i),this._view.mShandowGroup,n,!1,e.offset)},i.prototype.onPlayerFireCallBack=function(t){this.createBullet(t)},i.prototype.createBullet=function(e,i){void 0===i&&(i=!1);var o=e,s=this._mCtrlFishPlayer.getPlayerBySeaNumber(o.seat_number);if(!s)return void Log.warn("玩家 seat_number:",o.seat_number," 不存在");o.angle=o.angle?o.angle:App.MathUtils.random(30,150);var n=o.bullet_id,r=o.locked_fish_id,h=this._mIsMirror?t.FishUtil.getMirrorAngle(o.angle):o.angle,a=o.created_at,l=o.balance;this._lastBalance=o.balance,Log.log("createBullet 玩家账户余额:",o.balance),this.fire(n,s.mPlayerClientIndex,h,r,a,l,i)},i.prototype.onDeadFishsCallBack=function(t){var e=t.fish_catched,i=t.balance,o=t.seat_number,s=this._mCtrlFishPlayer.getPlayerBySeaNumber(o);for(var n in e){var r=e[n];this._mIsDataInited?this.showFishResult(s,r):this._mFishDeadCache.push(t)}Log.log("打中鱼，账户余额：",i),this._mIsDataInited&&s.updateMoney(i)},i.prototype.showFishResult=function(e,i){var o=i,s=e,n=o.fish_id,r=o.money,h=o.crit_multiple,a=this._mCtrlFish.getFish(n);a?(a.playDead(this._view.mFishGroup),t.SoundUtils.playCaptureSound(a.mId),this.playShake(a.mId,s.mIsMaster),this.showGoldEffect(a,r,s.mPlayerClientIndex,h,s.mIsMaster),Log.log("打中鱼了 id:",n,"money:",r,"暴击倍数：",h,o),100>=r&&egret.error("金币小于100:",o)):Log.warn("玩家 ",s.mPlayerClientIndex,"打中了没有的鱼 ID：",n),n==this._mLockFishId&&(this.clearBulletLock(n),this._isLockFish&&this.setLockFish())},i.prototype.clearBulletLock=function(t){this._mCtrlBullet.cleanBulletFish(t),this._mLockFishId=-1},i.prototype.onPlayerChangeCannon=function(e){if(R.intervalTime(100,"ChangeCannon")){var i=this._mCtrlFishPlayer.master,o=i.getCannonId();if(e.levels>0)o=e.levels;else if(e.isAddStr){var s=t.FishUtil.getCannonConfigById(o+1);s&&o++}else{var s=t.FishUtil.getCannonConfigById(o-1);s&&o--}this._mProxy.reqChangePao(o)}},i.prototype.onChangeGunCallBack=function(t){var e=this._mCtrlFishPlayer.getPlayerBySeaNumber(t.seat_number);e.updateCannon(t.gun_type),this._changeCannonView.refreshListOnChange(t.gun_type)},i.prototype.onSwitchSceneCallBack=function(t){var e=t.next_scene,i=t.start_time,o=t.background_id;this._mCtrlFish.runAway(),this._mCtrlFish.tideGo(i,e),this.playTideWaveAni(e,o),Log.log("鱼潮来临，切背景ID："+o)},i.prototype.playTideWaveAni=function(t,e){var i=RES.getRes("fish_tide"+t+"_json");if(i){var o=i.direction;this._bgManager.changeBg(e,o),this._view.playTideWave(o)}},i.prototype.onBossComingCallBack=function(t){},i.prototype.onFishTimeSyscCallBack=function(t){},i.prototype.onFishUnlockCallBack=function(t){},i.prototype.onErrorCallBack=function(t){1301!=t.code?e.prototype.onErrorCallBack.call(this,t):this.checkMoney(),this.resetAutoFire()},i.prototype.scaleCoinEffect=function(t){this._mCtrlFishPlayer.scaleCoinEffect(t)},i.prototype.addListeners=function(){e.prototype.addListeners.call(this),this._mProxy.addEvent(),this._mCtrlFish.addListeners(),this._mCtrlBullet.addListeners(),this._mCtrlGoldEff.addListeners(),this._mCtrlFishPlayer.addListeners()},i.prototype.removeListeners=function(){e.prototype.removeListeners.call(this),this._mCtrlFish.removeListeners(),this._mCtrlBullet.removeListeners(),this._mCtrlGoldEff.removeListeners(),this._mCtrlFishPlayer.removeListeners(),this._mProxy.removeEvent()},i.prototype.getModel=function(){return e.prototype.getModel.call(this)},Object.defineProperty(i.prototype,"gameView",{get:function(){return this._view},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){e.prototype.destroy.call(this),App.TimerManager.removeAll(this),this.onFishCreatedRelease(),t.FishUtil.clear(),t.BgConfig.clear(),t.TxtPack.clear(),this._mCtrlBullet.destroy(),this._mCtrlFishPlayer.destroy(),this._mCtrlFish.destroy(),this._mCtrlGoldEff.destroy(),this._mCtrlNet.destroy(),this._mCtrlFishHitBulb.destroy(),this._model.destroy(),this._mProxy.destroy(),this._view.destroy(),this._bgManager&&(this._bgManager.stopMoveBg(),this._bgManager.desdroyss(),this._bgManager=void 0),t.SoundUtils.isPlayingTdBGM=!1,this._mCtrlFish=void 0,this._mCtrlBullet=void 0,this._mCtrlGoldEff=void 0,this._mCtrlFishPlayer=void 0,this._view=void 0,this._model=void 0,this._mProxy=void 0,this._mCtrlNet=void 0,this._mCtrlFishHitBulb=void 0,this._mInitArrFish=void 0,this._mInitArrBullet=void 0,this._mFishDeadCache=void 0},i}(base.GameController);t.GameController=e,__reflect(e.prototype,"fishjoy.GameController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._mGoldEffList=null,i._mGoldSpecialList=null,i._mGoldBFEffList=null,i}return __extends(i,e),i.prototype.inits=function(){e.prototype.inits.call(this),this._mGoldEffList=[],this._mGoldSpecialList=[],this._mGoldBFEffList=[]},i.prototype.createGold=function(e,i,o,s,n,r,h,a,l){var p=t.GoldEff.create(0,r);p.setPos(e.x,e.y),h>0&&(s=t.FishUtil.getFishValue(a)*t.FishUtil.mFishBaseMultiple),p.refreshGold(i,s,o,n,h),p.setMaster(l),this._mGoldEffList.push(p),egret.Point.release(e),egret.Point.release(i)},i.prototype.createGoldSpecial=function(e,i,o,s,n){var r=t.GoldSpecial.create(0,o);r.setPos(s,100>n?n+160:n-160),r.refreshGold(i,e),this._mGoldSpecialList.push(r)},i.prototype.createBFEff=function(e,i,o,s){var n=t.FishBigEffBone.create();n.init(),n.setPosition(o,s),e>5e3?n.play(t.FishBigEffBone.special_large):e>4e3&&4005>=e?n.play(t.FishBigEffBone.large):e>3e3&&3010>e?n.play(t.FishBigEffBone.middle):e>2e3&&2015>e&&n.play(t.FishBigEffBone.small),n.parent||i.addChild(n),this._mGoldBFEffList.push(n)},i.prototype.update=function(e){for(var i=this._mGoldEffList,o=i.length-1;o>=0;o--){var s=i[o];s.isDead()&&(i.splice(o,1),t.GoldEff.release(s))}for(var n=this._mGoldSpecialList,o=n.length-1;o>=0;o--){var s=n[o];s.isDead()&&(n.splice(o,1),t.GoldSpecial.release(s))}for(var r=this._mGoldBFEffList,o=r.length-1;o>=0;o--){var s=r[o];s.isOver&&(r.splice(o,1),t.FishBigEffBone.release(s))}},i.prototype.getList=function(){return this._mGoldEffList},i.prototype.registers=function(){},i.prototype.addListeners=function(){},i.prototype.removeListeners=function(){},i.prototype.clean=function(){for(var e=this._mGoldEffList;e.length;){var i=e.pop();t.GoldEff.release(i)}for(var o=this._mGoldSpecialList;o.length;){var i=o.pop();t.GoldSpecial.release(i)}for(var s=this._mGoldBFEffList;s.length;){var i=s.pop();t.FishBigEffBone.release(i)}},i.prototype.destroy=function(){for(e.prototype.destroy.call(this);this._mGoldEffList.length;){var t=this._mGoldEffList.shift();t.destroy()}for(this._mGoldEffList=null,ObjectPool.clearClass("fishjoy.GoldEff","destroy");this._mGoldSpecialList.length;){var t=this._mGoldSpecialList.shift();t.destroy()}this._mGoldSpecialList=null,ObjectPool.clearClass("fishjoy.GoldSpecial","destroy");for(var i=this._mGoldBFEffList;i.length;){var o=i.pop();o.destroy()}this._mGoldBFEffList=null,ObjectPool.clearClass("fishjoy.FishBigEffBone","destroy")},i}(base.GameSeparateCtrl);t.GoldEffController=e,__reflect(e.prototype,"fishjoy.GoldEffController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._mHitBulbList=null,i}return __extends(i,e),i.prototype.inits=function(){e.prototype.inits.call(this),this._mHitBulbList=[]},i.prototype.createFishHitBulb=function(e,i,o){var s=t.FishHitBulbBones.create();s.init(),s.setPosition(i,o),s.parent||e.addChild(s),s.play(),this._mHitBulbList.push(s)},i.prototype.update=function(e){for(var i=this._mHitBulbList,o=i.length-1;o>=0;o--){var s=i[o];s.isOver&&(i.splice(o,1),t.FishHitBulbBones.release(s))}},i.prototype.getList=function(){return this._mHitBulbList},i.prototype.registers=function(){},i.prototype.addListeners=function(){},i.prototype.removeListeners=function(){},i.prototype.clean=function(){for(var e=this._mHitBulbList;e.length;){var i=e.pop();t.FishHitBulbBones.release(i)}},i.prototype.destroy=function(){for(e.prototype.destroy.call(this);this._mHitBulbList.length;){var t=this._mHitBulbList.pop();t.destroy()}this._mHitBulbList=null,ObjectPool.clearClass("fishjoy.FishHitBulbBones","destroy")},i}(base.GameSeparateCtrl);t.HitBulbController=e,__reflect(e.prototype,"fishjoy.HitBulbController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._mNetList=null,i}return __extends(i,e),i.prototype.inits=function(){e.prototype.inits.call(this),this._mNetList=[]},i.prototype.createNet=function(e,i,o,s){var n=t.Net.create(e,i);n.refreshNet(e),n.setServerId(e),n.setPos(o,s),this._mNetList.push(n)},i.prototype.update=function(e){for(var i=this._mNetList,o=i.length-1;o>=0;o--){var s=i[o];s.isDead()&&(i.splice(o,1),t.Net.release(s))}},i.prototype.getList=function(){return this._mNetList},i.prototype.registers=function(){},i.prototype.addListeners=function(){},i.prototype.removeListeners=function(){},i.prototype.clean=function(){for(var e=this._mNetList;e.length;){var i=e.pop();t.Net.release(i)}},i.prototype.destroy=function(){for(e.prototype.destroy.call(this);this._mNetList.length;){var t=this._mNetList.pop();t.destroy()}this._mNetList=null,ObjectPool.clearClass("fishjoy.Net","destroy")},i}(base.GameSeparateCtrl);t.NetController=e,__reflect(e.prototype,"fishjoy.NetController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(base.GameModel);t.FishPlayerMoudel=e,__reflect(e.prototype,"fishjoy.FishPlayerMoudel")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(base.GameModel);t.GameModel=e,__reflect(e.prototype,"fishjoy.GameModel")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t,i){return e.call(this,t,i)||this}return __extends(i,e),Object.defineProperty(i.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),i.prototype.addEvent=function(){e.prototype.addEvent.call(this),this.addListener(t.ProxyConst.ScFishPlayerEnterNotifyType,this.onPlayerEnter,this),this.addListener(t.ProxyConst.ScFishPlayerLeaveNotifyType,this.onPlayerLeave,this),this.addListener(t.ProxyConst.ScFishDistributeNotifyType,this.onDistribute,this),this.addListener(t.ProxyConst.ScFishFireNotifyType,this.onPlayerFire,this),this.addListener(t.ProxyConst.ScFishGameStatusNotifyType,this.onGameStatus,this),this.addListener(t.ProxyConst.ScFishDeadFishesNotifyType,this.onDeadFishes,this),this.addListener(t.ProxyConst.ScFishSwitchSceneNotifyType,this.onSwitchScene,this),this.addListener(t.ProxyConst.ScFishChangeGunNotifyType,this.onChangeGun,this),this.addListener(t.ProxyConst.ScFishBossComingNotifyType,this.onBossComing,this),this.addListener(t.ProxyConst.ScFishChatNotifyType,this.onChatNotify,this),this.addListener(t.ProxyConst.ScFishOffsetGroupNotifyType,this.onOffsetFishNotify,this)},i.prototype.onGameStatus=function(e){for(var i,o=e.players,s=this.getMasterServerIndex(o),n=[],r=1;4>=r;r++){var h=this.getPlayerFromServer(r,o);i=h?{uid:h.uid,server_index:h.seat_number+1,paoId:h.gun_type,nick_name:h.nickname,money:h.money,vip:h.vip}:{uid:-1,server_index:r,paoId:0,nick_name:"",money:0},n.push(i)}e.infoList=n,e.masterIndex=s,this.applyFunc(t.FishConst.onGameStatusCallBack,e)},i.prototype.getPlayerFromServer=function(t,e){for(var i in e){var o=e[i];if(t==o.seat_number+1)return o}return null},i.prototype.getMasterServerIndex=function(t){var e=this.player;for(var i in t){var o=t[i];if(e.getUserId()==o.uid)return o.seat_number+1}return 0},i.prototype.onPlayerEnter=function(e){var i=e.new_player,o={uid:i.uid,server_index:i.seat_number+1,paoId:i.gun_type,nick_name:i.nickname,money:i.money,vip:i.vip};e.info=o,this.applyFunc(t.FishConst.onPlayerEnterCallBack,e)},i.prototype.onPlayerLeave=function(e){this.applyFunc(t.FishConst.onPlayerLeaveCallBack,e)},i.prototype.onDistribute=function(e){this.applyFunc(t.FishConst.onDistributeCallBack,e)},i.prototype.onPlayerFire=function(e){this.applyFunc(t.FishConst.onPlayerFireCallBack,e)},i.prototype.onDeadFishes=function(e){this.applyFunc(t.FishConst.onDeadFishsCallBack,e)},i.prototype.onSwitchScene=function(e){this.applyFunc(t.FishConst.onSwitchSceneCallBack,e)},i.prototype.onChangeGun=function(e){this.applyFunc(t.FishConst.onChangeGunCallBack,e)},i.prototype.onBossComing=function(e){this.applyFunc(t.FishConst.onBossComingCallBack,e)},i.prototype.onOffsetFishNotify=function(e){this.applyFunc(t.FishConst.onOffsetFishNotify,e)},i.prototype.onTimeSync=function(e){this.applyFunc(t.FishConst.onFishTimeSyscCallBack,e)},i.prototype.onFishUnlock=function(e){this.applyFunc(t.FishConst.onFishUnlockCallBack,e)},i.prototype.onChatNotify=function(e){this.applyFunc(t.FishConst.onFishChatBack,e)},i.prototype.reqFishChat=function(e){this.send(t.ProxyConst.CsFishChatReqType,e)},i.prototype.reqPlayerReady=function(e){this.send(t.ProxyConst.CsFishPlayerReadyReqType,e)},i.prototype.reqPlayerFire=function(e,i,o){if(R.intervalTime(80,"reqPlayerFire")){var s={gun_multiple:e,angle:i,locked_fish_id:o?o:0,client_tick:GameBase.getCurrServerTime()};this.send(t.ProxyConst.CsFishPlayerFireReqType,s)}},i.prototype.reqChangePao=function(e){var i={gun_type:e};this.send(t.ProxyConst.CsFishChangeGunReqType,i)
},i.prototype.reqHitFish=function(e,i,o){var s={fish_id:e,fish_type:i,bullet_id:o};this.send(t.ProxyConst.CsFishCollidedNotifyType,s)},i.prototype.reqTimeSync=function(t){},i.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),e.prototype.removeMsgEventAll.call(this,this)},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i}(base.GameProxy);t.GameProxy=e,__reflect(e.prototype,"fishjoy.GameProxy")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.parsBgConfig=function(){var t=RES.getRes("Backgrounds_json");Log.log("背景配置解析：",t),this.bgDic=t;for(var e in t){var i=t[e].bulbPosition,o=i.split("|"),s=[];for(var n in o){var r={},h=o[n].split(","),a=Number(h[0]),l=Number(h[1]);r.dot={},r.dot.x=a,r.dot.y=l,s.push(r)}t[e].pList=s}},t.getBgDataByIndex=function(t){return this.bgDic["data_"+t]||""},t.clear=function(){t.bgDic=void 0},t.bgDic=null,t}();t.BgConfig=e,__reflect(e.prototype,"fishjoy.BgConfig")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.getCannonConfigById=function(e){t._mCannonConfig||(t._mCannonConfig=RES.getRes("gun_config_json"));var i=t._mCannonConfig["data_"+e];return i},t.parseFishTideCfg=function(){var e=RES.getRes("fishTidePath_json"),i=-1;for(var o in e){i=parseInt(o.split("_")[1]);var s={};s.speed=e[o].speed;var n=e[o].startPoint.split(","),r=new egret.Point(parseInt(n[0]),parseInt(n[1])),h=e[o].endPoint.split(","),a=new egret.Point(parseInt(h[0]),parseInt(h[1]));s.startPoint=r,s.endPoint=a;var l=e[o].fishList.split("|"),p=[],c=0,u=l.length;for(c=0;u>c;c++){var d={},m=l[c].split(",");d.fishID=parseInt(m[0]);var f=m[1].split("-"),y=parseInt(f[0]),_=parseInt(f[1]),g=new egret.Point(y,_);d.posi=g;var v=m[2].split("-"),C=parseInt(v[0]),b=parseInt(v[1]),F=new egret.Point(C,b);d.offset=F;var T=m[3].split("-"),B=parseInt(T[0]),E=parseInt(T[1]),P=parseInt(T[2]);d.centerPos=[B,E,P],p.push(d)}s.list=p,t._fishTidess["tide_"+i]=s}},t.getFishTideCfg=function(e){return t._fishTidess["tide_"+e]},t.parseFishCfg=function(){var e,i=RES.getRes("fish_json");for(var o in i){e=o.split("_")[1];var s=i[o].FishCollide,n=s.split("|"),r=[];for(var h in n){var a=n[h].split(","),l={},p=Number(a[0]),c=Number(a[1]);l.dot={},l.dot.x=p,l.dot.y=c,l.radius=Number(a[2]),r.push(l)}t.initFishHitRect(e,r),t.initFishGoldCoins(e,i[o].GoldCoins),t.initFishSpeedCoef(e,i[o].SpeedCoefficient),t.initFishValue(e,i[o].FishValue)}},t.initFishGoldCoins=function(e,i){var o=t._mFishBaseConfig;o.GoldCoins||(o.GoldCoins={}),o.GoldCoins["cfg_"+e]=i},t.initFishValue=function(e,i){var o=t._mFishBaseConfig;o.fishValues||(o.fishValues={}),o.fishValues["cfg_"+e]=i},t.getFishValue=function(e){return t._mFishBaseConfig.fishValues["cfg_"+e]},t.initFishSpeedCoef=function(e,i){var o=t._mFishBaseConfig;o.speedCoef||(o.speedCoef={}),o.speedCoef["cfg_"+e]=i},t.getFishSpeedCoef=function(e){return t._mFishBaseConfig.speedCoef["cfg_"+e]},t.getFishGoldCoins=function(e){return t._mFishBaseConfig.GoldCoins["cfg_"+e]},t.initFishHitRect=function(e,i){var o=t._mFishBaseConfig;o.hitRect||(o.hitRect={}),o.hitRect["cfg_"+e]=i},t.getFishHitRect=function(e){return t._mFishBaseConfig.hitRect["cfg_"+e]},t.getMirrorAngle=function(t){return-t},t.setFishBaseConfig=function(e){t._mFishBaseConfig.cfg=e},Object.defineProperty(t,"mFishBaseMultiple",{get:function(){var e=t._mFishBaseConfig.cfg;return e?e.multiple:1},enumerable:!0,configurable:!0}),t.clear=function(){t._mFishBaseConfig={},t._fishTidess={},t._mCannonConfig=void 0},t._mFishBaseConfig={},t._fishTidess={},t}();t.FishUtil=e,__reflect(e.prototype,"fishjoy.FishUtil")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.playBGM=function(){App.SoundManager.stopBg(),t.bgmIndex=this.getIndex(3),App.SoundManager.playBg("FisheryBGM"+t.bgmIndex+"_mp3"),t.isPlayingTdBGM=!1},t.getIndex=function(e){var i=Math.floor(3*Math.random())+1;return i==t.bgmIndex&&this.getIndex(e),i},t.getIndex2=function(e){var i=Math.floor(2*Math.random())+1;return i==t.tideBgmIndex&&this.getIndex(e),i},t.playHallBGM=function(){App.SoundManager.stopBg(),App.SoundManager.playBg("HallBGM_mp3")},t.playTideBGM=function(){t.isPlayingTdBGM||(t.isPlayingTdBGM=!0,App.SoundManager.stopBg(),t.tideBgmIndex=this.getIndex2(2),App.SoundManager.playBg("TideBGM"+t.tideBgmIndex+"_mp3"))},t.playCaptureSound=function(t){t>2e3&&2015>t||t>3e3&&3010>t?App.SoundManager.playEffect("CaptureSE1_mp3"):t>4e3&&4006>t?App.SoundManager.playEffect("CaptureSE2_mp3"):t>5e3&&5004>t&&App.SoundManager.playEffect("CaptureSE3_mp3")},t.playSwitchPao=function(){App.SoundManager.playEffect("SwitchSE_mp3")},t.playplusSound=function(){App.SoundManager.playEffect("PlusSE_mp3")},t.playFireSound=function(){App.SoundManager.playEffect("CannonSE_mp3")},t.playHitSound=function(){App.SoundManager.playEffect("HitSE_mp3")},t.playCoinSound=function(){App.SoundManager.playEffect("CionSE_mp3")},t.playWaveSound=function(){App.SoundManager.playEffect("WaveSE_mp3")},t.playGoBackSound=function(){App.SoundManager.playEffect("BackSE_mp3")},t.playEnterSound=function(){App.SoundManager.playEffect("EnterSE_mp3")},t.playBtnSound=function(){App.SoundManager.playEffect("ButtonSE_mp3")},t.bgmIndex=1,t.tideBgmIndex=1,t.isPlayingTdBGM=!1,t}();t.SoundUtils=e,__reflect(e.prototype,"fishjoy.SoundUtils")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.parsTxt=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,RES.getResByUrl("textPack_fishjoy_json",function(e,i){t.lockDic=e.lockTxts,t.chatTxtss=e.chatTxts,t.explainTxtss=e.explainTxts,t.lockTxtIDArr=[];for(var o in t.lockDic)t.lockTxtIDArr.push(o);t.chatTxtIDArr=[];for(var o in t.chatTxtss)t.chatTxtIDArr.push(o)})];case 1:return e.sent(),[2]}})})},t.getLockTxt=function(e){return t.lockDic||t.parsTxt(),t.lockDic[e]||""},t.getChatTxt=function(e){return t.chatTxtss||t.parsTxt(),t.chatTxtss[e]||""},t.getChatTxtByIndex=function(e){var i="9009";switch(e){case 0:i="9009";break;case 1:i="90010";break;case 2:i="90011";break;case 3:i="90012";break;case 4:i="90013"}return t.getChatTxt(i)},t.getExplainTxt=function(e){return t.explainTxtss||t.parsTxt(),t.explainTxtss[e]},t.clear=function(){t.lockDic=void 0,t.lockTxtIDArr=null,t.chatTxtss=void 0,t.chatTxtIDArr=null,t.explainTxtss=void 0},t.lockDic=null,t.lockTxtIDArr=null,t.chatTxtss=null,t.chatTxtIDArr=null,t.explainTxtss=null,t}();t.TxtPack=e,__reflect(e.prototype,"fishjoy.TxtPack")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function e(){this._bgIndex=0,this._leftBorder=-1450,this._rightBorder=1450,this._pointX=400,this._bitmap=null,this._bitMask=null,this._step=.1,this.isNeedMoveing=!1}return e.prototype.inits=function(t){this._gameView=t,this._bgIndex=GameModuleMgr.i.getCurrSceneType();var e=this._bgIndex;this._gameView.foreBg.setBgData(e),this._gameView.foreBg1.setBgData(e),this._gameView.backGroup2.visible=!1,this._gameView.changeBg.visible=!1},e.prototype.setBgIndexOnEnter=function(t){var e=t.fish_tide;this._bgIndex=e.background_id;var i=this._bgIndex;this._gameView.foreBg.setBgData(i),this._gameView.foreBg1.setBgData(i),this._gameView.foreBg.x=0,this._gameView.foreBg1.x=this._rightBorder,this._gameView.backGroup2.visible=!1,Log.log("初始进入，房间数据状态广播： bgID=",e.background_id),this.isNeedMoveing=!0},e.prototype.update=function(){if(this.isNeedMoveing){var t=this._step;this._gameView.foreBg.x-=t,this._gameView.foreBg.x<=this._leftBorder&&(this._gameView.foreBg.x=this._rightBorder-2),this._gameView.foreBg1.x-=t,this._gameView.foreBg1.x<=this._leftBorder&&(this._gameView.foreBg1.x=this._rightBorder-2)}},e.prototype.BgMove=function(){this.isNeedMoveing=!0},e.prototype.stopMoveBg=function(){this.isNeedMoveing=!1,this._bitmap&&(this._bitmap.parent&&this._bitmap.parent.removeChild(this._bitmap),this._bitmap=null),this._bitMask&&(this._bitMask.parent&&this._bitMask.parent.removeChild(this._bitMask),this._bitMask=null),this._gameView&&this._gameView.backGroup2&&(this._gameView.backGroup2.visible=!1)},e.prototype.changeBg=function(t,e){this._bgIndex=t,this._dirction=e},e.prototype.screenShotBeforStart=function(){this.stopMoveBg(),this._bitmap||(this._bitmap=new egret.Bitmap);var t=App.StageUtils.getWidth(),e=App.StageUtils.getHeight();this._bitMask=new egret.Shape,this._bitMask.graphics.beginFill(16711935),this._bitMask.graphics.drawRect(0,0,t,e),this._bitMask.graphics.endFill(),this._gameView.backGroup2.addChild(this._bitMask),this._bitmap.mask=this._bitMask;var i=this._gameView.backGroup,o=new egret.RenderTexture;o.drawToTexture(i,new egret.Rectangle(0,0,t,e));this._bitmap.texture=o,this._gameView.backGroup2.addChild(this._bitmap),this._dirction>0?(this._bitMask.x=t,this._bitMask.scaleX=-1):(this._bitMask.x=0,this._bitMask.scaleX=1),this._gameView.backGroup2.visible=!0,this._gameView.foreBg.x=0,this._gameView.foreBg1.x=this._rightBorder,this._gameView.foreBg.setBgData(this._bgIndex),this._gameView.foreBg1.setBgData(this._bgIndex)},e.prototype.changeBgPos=function(t){var e=this._dirction,i=App.StageUtils.getWidth();if(!(e>0&&t-208>=i||0>e&&0>=t+208)){var o=1;o=0>e?(t+208)/i:(t-208)/i-1,this._bitMask.scaleX=o}},e.prototype.onComplete=function(){this._bitmap&&this._bitmap.parent&&(this._bitmap.parent.removeChild(this._bitmap),this._bitmap=null),this._bitMask&&(this._bitMask.parent&&this._bitMask.parent.removeChild(this._bitMask),this._bitMask=null),this._gameView.backGroup2.visible=!1,t.SoundUtils.playTideBGM(),this.BgMove()},e.prototype.desdroyss=function(){this._gameView&&this._gameView.foreBg&&egret.Tween.removeTweens(this._gameView.foreBg),this._gameView&&this._gameView.foreBg1&&egret.Tween.removeTweens(this._gameView.foreBg1),this._bitmap&&(this._bitmap.parent&&this._bitmap.parent.removeChild(this._bitmap),this._bitmap=null),this._bitMask&&(this._bitMask.parent&&this._bitMask.parent.removeChild(this._bitMask),this._bitMask=null)},e}();t.BgManagers=e,__reflect(e.prototype,"fishjoy.BgManagers")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.bubbleList=[],t.skinName="BgUISkin",t}return __extends(i,e),i.prototype.initComponent=function(t){e.prototype.initComponent.call(this,t),this.touchEnabled=!1,this.touchChildren=!1},i.prototype.setBgData=function(e){0==e&&(e=GameModuleMgr.i.getCurrSceneType()),this.clearBubList(),this.bubbleList=[];var i=t.BgConfig.getBgDataByIndex(e);this.bgData=i,this.bgImg.source=i.backGArt;for(var o=i.pList,s=o.length,n=0;s>n;n++){var r=new eui.Group,h=new BaseParticleObj;h.init(i.bulbGArt),r.addChild(h),h.x=-208,h.y=-300,h.play(),h.touchEnabled=!1,h.touchChildren=!1,r.touchEnabled=!1,r.touchChildren=!1,this.addChild(r),r.x=o[n].dot.x,r.y=o[n].dot.y,this.bubbleList.push(r)}},i.prototype.clearBubList=function(){if(this.bubbleList){for(var t=this.bubbleList.length,e=0;t>e;e++){var i=this.bubbleList[e].removeChildAt(0);i.destroy(),i=null,this.bubbleList[e]=void 0}this.bubbleList.length=0}this.bubbleList=null},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.clearBubList(),this.bgData&&(this.bgData=null),this.bgImg&&this.bgImg.parent&&(this.bgImg.parent.removeChild(this.bgImg),this.bgImg=null)},i}(BaseEuiComponent);t.BgUI=e,__reflect(e.prototype,"fishjoy.BgUI")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._mIsAddEvent=!1,e}return __extends(e,t),e.prototype.init=function(){this._mIsAddEvent||(this._mIsAddEvent=!0,App.EffectUtils.addEffectBtn(this.btnWei,this.onWeiTouchTap,this),App.EffectUtils.addEffectBtn(this.btnYi,this.onYiTouchTap,this),App.EffectUtils.addEffectBtn(this.btnLocked,this.onLockedTouchTap,this),this.addEventListener(egret.Event.REMOVED,this.onRemove,this))},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this.init(),this.btnWei.visible=this.btnLocked.visible=this.btnYi.visible=!1;var e=this.data.isUnLock;this.cannonImg.source=this.data.res,this.cannonLabel.text=this.data.txt,this.lockedImg.visible=!e,this.btnLocked.visible=!e,this.btnWei.visible=e&&!this.data.isCurr,this.btnYi.visible=e&&this.data.isCurr}},e.prototype.onWeiTouchTap=function(t){this.data.isCurr||this.data.onItemTap&&this.data.onItemTap.call(this.data.onThisObj,this.data)},e.prototype.onLockedTouchTap=function(t){},e.prototype.onYiTouchTap=function(t){},e.prototype.onRemove=function(t){this.removeEventListener(egret.Event.REMOVED,this.onRemove,this),this.destroy()},e.prototype.destroy=function(){Log.log("ChangeCannonItem destroy.. "),App.EffectUtils.removeEffectBtn(this.btnWei,this.onWeiTouchTap,this),App.EffectUtils.removeEffectBtn(this.btnYi,this.onYiTouchTap,this),App.EffectUtils.removeEffectBtn(this.btnLocked,this.onLockedTouchTap,this),this.data.onItemTap=void 0,this.data.onThisObj=void 0,this.data=void 0,this._mIsAddEvent=!1},e}(eui.ItemRenderer);t.ChangeCannonItem=e,__reflect(e.prototype,"fishjoy.ChangeCannonItem")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){return e.call(this,t,LayerManager.Game_Main,"fishjoy","ChangeCannonSkin")||this}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.initDatass(),this.refreshGameList(),this.changeItem.dataProvider=this._mArrData},i.prototype.initDatass=function(){for(var e=[],i=1;2>=i;i++){var o={};o.id=i,o.res=1==i?"grabfish_ui_gun5":"grabfish_ui_gun1",o.txt=t.TxtPack.getLockTxt(""+(9e3+i)),o.isUnLock=!1,o.isCurr=!1,o.onItemTap=this.onItemTap,o.onThisObj=this,e.push(o)}e[0].isUnLock=!0,e[1].isUnLock=!0,this._mArrData=new eui.ArrayCollection(e)},i.prototype.open=function(t){e.prototype.open.call(this,t);for(var i=Math.floor(t/1e3),o=this._mArrData,s=this._mArrData.length,n=0;s>n;n++){var r=o.getItemAt(n);r.isCurr=r.id==i}Log.log("type",i,"data",t),this._mArrData.refresh(),this.changeItem.dataProvider=this._mArrData,this.scaleX=App.fixUISX(),App.EffectUtils.showView2(this,300,0,0,this.scaleX,1)},i.prototype.refreshListOnChange=function(t){var e=Math.floor(t/1e3);this._mArrData||this.initDatass();for(var i=this._mArrData,o=this._mArrData.length,s=0;o>s;s++){var n=i.getItemAt(s);n.isCurr=n.id==e}Log.log("type",e,"data",t),this._mArrData.refresh(),this.changeItem.dataProvider=this._mArrData},i.prototype.refreshGameList=function(){this.changeItem.itemRenderer=t.ChangeCannonItem,this.changeItem.itemRendererSkinName="resource/games/fishjoy/skins/component/ChangeCannonItemSkin.exml",this.changeScroller.viewport.scrollH=0,this.changeScroller.viewport=this.changeItem},i.prototype.addEvent=function(){e.prototype.addEvent.call(this),this.mainGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.groupClick,this),App.EffectUtils.addEffectBtn(this.btnClose,this.closeHandle,this),this.ScrollBox.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.ScrollBox.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},i.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this.mainGroup.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.groupClick,this),App.EffectUtils.removeEffectBtn(this.btnClose,this.closeHandle,this),this.ScrollBox.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.ScrollBox.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},i.prototype.groupClick=function(t){},i.prototype.onItemTap=function(e){var i=1e3*e.id+1;this.applyFunc(t.FishConst.Player_Change_Cannon,{isAddStr:!1,levels:i}),t.SoundUtils.playSwitchPao(),Log.log("换炮onItemTap ",e,i)},i.prototype.closeHandle=function(e){App.EffectUtils.hideView(this,function(){App.ViewManager.close(t.ViewsConst.ChangeCanon)},this)},i.prototype.touchMove=function(t){this.changeScroller.stopAnimation(),this.ScrollBox.width=930,this.ScrollBox.x=0;var e=this.changeScroller.viewport;t.localY<54?e.scrollV=0:t.localY>e.height-54?e.scrollV=this.changeItem.contentHeight-e.height:e.scrollV=(this.changeItem.contentHeight-e.height)/(e.height-108)*(t.localY-54)},i.prototype.touchEnd=function(){this.ScrollBox.width=34,this.ScrollBox.x=671},i.prototype.destroy=function(){this._isDestroy||(e.prototype.destroy.call(this),this.changeItem.removeChildren())},i}(base.GameView);t.ChangeCannonView=e,__reflect(e.prototype,"fishjoy.ChangeCannonView")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){return e.call(this,t,LayerManager.Game_Main,"fishjoy","FishJoyGameSkin")||this}return __extends(i,e),i.prototype.getFishLay=function(t,e){var i=e?this.fishTide:this.fishGroup;if(i.numChildren<1)for(var o=0;10>o;o++)i.addChild(new egret.DisplayObjectContainer);return i.getChildAt(Math.floor(t/1e3))},Object.defineProperty(i.prototype,"mFishGroup",{get:function(){return this.fishGroup},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mFishGroupTide",{get:function(){return this.fishTide},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mShandowGroup",{get:function(){return this.shandowGroup},enumerable:!0,configurable:!0}),i.prototype.initUI=function(){e.prototype.initUI.call(this),this.btnYu.visible=App.IsTest,this.txtShowHit.visible=App.IsTest,this.backGroup.touchEnabled=!0,this.backGroup.touchChildren=!1,this.backGroup2.touchEnabled=!1,this.backGroup2.touchChildren=!1,this.fishGroup.touchEnabled=!1,this.fishGroup.touchChildren=!1,this.bulletGroup.touchChildren=!1,this.bulletGroup.touchEnabled=!1,this.effectGroup.touchChildren=!1,this.effectGroup.touchEnabled=!1,this.playerGroup.touchEnabled=!1,this.chatGroup.visible=!1,this.menuGroup.visible=!1;for(var i=1;4>=i;i++)this.getPlayerRender(i).initComponent(this._controller);this.foreBg.initComponent(this._controller),this.foreBg1.initComponent(this._controller),this.changeBg.initComponent(this._controller),this.TipsPromt.initComponent(this._controller),this._mTideWave=new t.TideWave,this._mTideWave.init(),this.btnRedPacket2=RedPackBone.create(),this.btnRedPacket2.init(),this.uiGroup.addChild(this.btnRedPacket2),this.btnRedPacket2.x=40,this.btnRedPacket2.y=124,this.btnRedPacket2.play(RedPackBone.Animation1),this.btnRedPacket2.touchEnabled=!0,this.initBroadcast(this),this.mBroadcastView.scaleX=App.fixUISX(),App.OffsetBottom(this.btnAutoShoot),App.OffsetBottom(this.btnLock)},i.prototype.setTouchEnable=function(t){this.playerGroup.touchChildren=t,this.uiGroup.touchChildren=t},i.prototype.setChatPos=function(t){1==t?(this.chatGroup.x=2,this.btnChat.x=2):2==t&&(this.chatGroup.x=1048,this.btnChat.x=1048)},i.prototype.addEvent=function(){e.prototype.addEvent.call(this),this.btnYu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnYu,this),this.backGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.backGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.backGroup.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.backGroup.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.btnMenu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenu,this),this.btnChat.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChat,this),this.menuGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuGroup,this),this.chatGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatGroup,this),this.btnAutoShoot.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAutoShoot,this),this.btnLock.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLockFish,this),this.btnRedPacket2.addEventListener(egret.TouchEvent.TOUCH_END,this.onOpenRedPac,this),App.MessageCenter.addListener(RedPacketConst.newRedEnvelopeNotity,this.RedPackNotify,this),App.MessageCenter.addListener(RedPacketConst.grabRedEnvelopeBack,this.grabRedPackBack,this),App.MessageCenter.addListener(RedPacketConst.expiredRedEnvelopeNotify,this.expirePack,this),App.CommonUtils.effectButton(this.btnExit,this.onGameExit,this);for(var t=1;4>=t;t++)this.getPlayerRender(t).addEvent()},i.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this.btnYu.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnYu,this),this.backGroup.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.backGroup.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.backGroup.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.backGroup.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.btnMenu.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenu,this),this.btnChat.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChat,this),this.menuGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuGroup,this),this.chatGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatGroup,this),this.btnAutoShoot.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAutoShoot,this),this.btnLock.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLockFish,this),this.btnRedPacket2.removeEventListener(egret.TouchEvent.TOUCH_END,this.onOpenRedPac,this),App.MessageCenter.removeListener(RedPacketConst.newRedEnvelopeNotity,this.RedPackNotify,this),App.MessageCenter.removeListener(RedPacketConst.grabRedEnvelopeBack,this.grabRedPackBack,this),App.MessageCenter.removeListener(RedPacketConst.expiredRedEnvelopeNotify,this.expirePack,this),App.CommonUtils.removeButton(this.btnExit);for(var t=1;4>=t;t++)this.getPlayerRender(t).removeEvent()},i.prototype.shakeScreen=function(){var t=this;egret.Tween.removeTweens(this),this.scaleX=1,this.scaleY=1,egret.Tween.get(this).to({scaleX:1.02,scaleY:1.02},100).wait(10).to({scaleX:1,scaleY:1},100).wait(10).to({scaleX:1.02,scaleY:1.02},100).wait(10).to({scaleX:1,scaleY:1},100).call(function(){t.scaleX=1,t.scaleY=1,egret.Tween.removeTweens(t)})},i.prototype.removeShakeBlank=function(){},i.prototype.onOpenRedPac=function(){App.ViewManager.open(LobbyViewConst.RedPacket),this.btnRedPacket2.play(RedPackBone.Animation1),this.applyFunc(t.FishConst.hide_master_paopao)},i.prototype.RedPackNotify=function(){this.btnRedPacket2.play(RedPackBone.Animation)},i.prototype.grabRedPackBack=function(){this.btnRedPacket2.play(RedPackBone.Animation1)},i.prototype.expirePack=function(){this.btnRedPacket2.play(RedPackBone.Animation1)},i.prototype.onAutoShoot=function(e){t.SoundUtils.playBtnSound(),this.applyFunc("onAutoShoot",this.btnAutoShoot.selected),this.applyFunc(t.FishConst.hide_master_paopao)},i.prototype.onLockFish=function(e){t.SoundUtils.playBtnSound(),this.applyFunc("onLockFish",this.btnLock.selected),this.applyFunc(t.FishConst.hide_master_paopao)},i.prototype.resetAutoUI=function(){this.btnAutoShoot.selected=!1},i.prototype.resetLockFishBtn=function(){this.btnLock.selected=!1},i.prototype.hideMenu=function(){this.menuGroup.visible=!1},i.prototype.onMenu=function(){this.applyFunc(t.FishConst.hide_master_paopao),t.SoundUtils.playBtnSound(),this.menuGroup.visible=!this.menuGroup.visible,this.menuGroup.visible?this.btnMenu.source="grabfish_ui_manubutten2":this.btnMenu.source="grabfish_ui_manubutten",this.chatGroup.visible=!1},i.prototype.onChat=function(){this.applyFunc(t.FishConst.hide_master_paopao),this.chatGroup.visible=!this.chatGroup.visible,this.hideMenu()},i.prototype.onMenuGroup=function(e){switch(e.target.name){case"btnGuide":t.SoundUtils.playBtnSound(),this.applyFunc("GuideClickFunc");break;case"btnSetting":t.SoundUtils.playBtnSound(),this.applyFunc("SettingClickFunc");break;case"btnChangeCannon":t.SoundUtils.playBtnSound(),this.applyFunc("ChangeCannonClickFunc");break;case"btnhelp":t.SoundUtils.playBtnSound(),this.applyFunc("HelpClickFunc");break;case"btnChat":t.SoundUtils.playBtnSound(),this.chatGroup.visible=!this.chatGroup.visible}},i.prototype.onGameExit=function(){this.onBack()},i.prototype.onChatGroup=function(e){var i,o;i=e.target.name,o=i.split("_"),this.applyFunc(t.FishConst.PLAYER_CHAT,o[1]),this.chatGroup.visible=!1},i.prototype.getPlayerRender=function(t){var e=this;return e["player"+(t-1)]},i.prototype.onBack=function(){this.applyFunc(t.FishConst.CLICKBACKROOM)},i.prototype.onTouchBegin=function(t){this.setTouchEnable(!1),this.applyFunc("onTouchBegin",t.localX,t.localY)},i.prototype.onTouchEnd=function(t){this.setTouchEnable(!0),this.applyFunc("onTouchEnd",t.localX,t.localY)},i.prototype.onTouchMove=function(t){this.applyFunc("onTouchMove",t.localX,t.localY)},i.prototype.onBtnYu=function(e){t.FishConst.mIsShowFishHit=!t.FishConst.mIsShowFishHit,this.txtShowHit.text=t.FishConst.mIsShowFishHit?"关闭显示碰撞区域":"打开显示碰撞区域",this.applyFunc("onBtnYu"),BroadcastView.testPlay(),App.getWpH()},i.prototype.onBtnPaoRemove=function(t){this.applyFunc("onBtnPaoRemove")},i.prototype.onBtnPaoAdd=function(t){this.applyFunc("onBtnPaoAdd")},i.prototype.playTideWave=function(e){this._mTideWave.parent||this.effectGroup.addChild(this._mTideWave),this._mTideWave.addEventListener(t.TideWave.WAVE_START,this.waveStart,this),this._mTideWave.addEventListener(t.TideWave.WAVE_MOVE,this.waveMove,this),this._mTideWave.addEventListener(egret.Event.COMPLETE,this.waveEnd,this),this._mTideWave.play(e)},i.prototype.waveEnd=function(e){this._mTideWave&&(this._mTideWave.removeEventListener(t.TideWave.WAVE_START,this.waveStart,this),this._mTideWave.removeEventListener(t.TideWave.WAVE_MOVE,this.waveMove,this),this._mTideWave.removeEventListener(egret.Event.COMPLETE,this.waveEnd,this)),this.applyFunc("waveEnd")},i.prototype.waveStart=function(t){this.applyFunc("screenshots")},i.prototype.waveMove=function(t){this.applyFunc("changeBgPos",t.data)},i.prototype.removeTideWave=function(){this._mTideWave&&(this._mTideWave.destroy(),this._mTideWave=void 0)},i.prototype.destroy=function(){this._isDestroy||(e.prototype.destroy.call(this),this.removeTideWave(),this.fishGroup.removeChildren(),this.btnRedPacket2&&(this.btnRedPacket2.parent&&this.btnRedPacket2.parent.removeChild(this.btnRedPacket2),this.btnRedPacket2=void 0),this.TipsPromt.destroy(),this.TipsPromt=void 0,this.foreBg.destroy(),this.foreBg1.destroy(),this.changeBg.destroy(),this.foreBg=void 0,this.foreBg1=void 0,this.changeBg=void 0,Log.trace("销毁 fishjoy.GameView"))},i}(base.GameView);t.GameView=e,__reflect(e.prototype,"fishjoy.GameView")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="GuideItemSkin",t}return __extends(i,e),i.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data&&(this.cannonImg.source=this.data.FishUI,this.labelGold.text="+ "+CommonUtils.getInstance().money2StrTwo(this.data.FishValue*t.FishUtil.mFishBaseMultiple))},i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i}(eui.ItemRenderer);t.GuideItem=e,__reflect(e.prototype,"fishjoy.GuideItem")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){return e.call(this,t,LayerManager.Game_Main,"fishjoy","GuideSkin")||this}return __extends(i,e),i.prototype.open=function(){e.prototype.open.call(this);var i=t.TxtPack.getExplainTxt("90014");this.tips_lable.text=i,this.refreshGameList(),this.scaleX=App.fixUISX(),App.EffectUtils.showView2(this,300,0,0,this.scaleX,1,function(){App.MouseUtils.addMouseWheel(this.onMouseWheel,this)}.bind(this))},i.prototype.onMouseWheel=function(t){common.GUtils.touchMouseWheel(this.guideScorller,this.guideList,t.data)},i.prototype.addEvent=function(){e.prototype.addEvent.call(this),App.EffectUtils.addEffectBtn(this.btnClose,this.closeHandle,this),this.ScrollBox.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.ScrollBox.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},i.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),App.EffectUtils.removeEffectBtn(this.btnClose),this.ScrollBox.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.ScrollBox.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},i.prototype.refreshGameList=function(){var e=RES.getRes("fish_json"),i=new eui.ArrayCollection;for(var o in e)i.addItem(e[o]);this.guideList.itemRenderer=t.GuideItem,this.guideList.dataProvider=i,this.guideScorller.viewport.scrollH=0,this.guideScorller.viewport=this.guideList},i.prototype.touchMove=function(t){this.guideScorller.stopAnimation(),this.ScrollBox.width=930,this.ScrollBox.x=0;var e=this.guideScorller.viewport;t.localY<54?e.scrollV=0:t.localY>e.height-54?e.scrollV=this.guideList.contentHeight-e.height:e.scrollV=(this.guideList.contentHeight-e.height)/(e.height-108)*(t.localY-54)},i.prototype.touchEnd=function(){this.ScrollBox.width=34,this.ScrollBox.x=637},i.prototype.closeHandle=function(){App.EffectUtils.hideView(this,function(){App.ViewManager.close(t.ViewsConst.Guide)},this),App.MouseUtils.removeMouseWheel()},i}(base.GameView);t.GuideView=e,__reflect(e.prototype,"fishjoy.GuideView")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t,LayerManager.Game_Main,"fishjoy","SettingSkin")||this;return i.vMultiple=100,i}return __extends(i,e),i.prototype.initUI=function(){},i.prototype.open=function(){e.prototype.open.call(this),this.initSet(),this.scaleX=App.fixUISX(),App.EffectUtils.showView2(this,300,0,0,this.scaleX,1)},i.prototype.initSet=function(){App.SoundManager.setEffectOn(!0),App.SoundManager.setBgOn(!0),this.VoiceSlider.minimum=0,this.VoiceSlider.maximum=this.vMultiple,this.VoiceSlider.value=App.SoundManager.getEffectVolume()*this.vMultiple,this.MusicSlider.minimum=0,this.MusicSlider.maximum=this.vMultiple,this.MusicSlider.value=App.SoundManager.getBgVolume()*this.vMultiple},i.prototype.addEvent=function(){this.mainGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mainGroupClick,this),this.btnClose.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.closeHandle,this),this.VoiceSlider.addEventListener(egret.Event.CHANGE,this.onChangeValue,this),this.MusicSlider.addEventListener(egret.Event.CHANGE,this.onChangeValue,this),this.btn_musicOff.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this),this.btn_musicOn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this),this.btn_soundOff.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this),this.btn_soundOn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this)},i.prototype.removeEvent=function(){this.mainGroup.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mainGroupClick,this),this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.closeHandle,this),this.VoiceSlider.removeEventListener(egret.Event.CHANGE,this.onChangeValue,this),this.MusicSlider.removeEventListener(egret.Event.CHANGE,this.onChangeValue,this),this.btn_musicOff.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this),this.btn_musicOn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this),this.btn_soundOff.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this),this.btn_soundOn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onOpen,this)},i.prototype.onChangeValue=function(t){var e;switch(t.currentTarget){case this.VoiceSlider:e=this.VoiceSlider.value/this.vMultiple,App.SoundManager.setEffectVolume(e);break;case this.MusicSlider:e=this.MusicSlider.value/this.vMultiple,App.SoundManager.setBgVolume(e)}},i.prototype.onOpen=function(t){switch(t.currentTarget){case this.btn_musicOff:App.SoundManager.setBgOn(!1),this.voiceHandler(0,!1);break;case this.btn_musicOn:App.SoundManager.setBgOn(!0),this.voiceHandler(100,!1);break;case this.btn_soundOff:App.SoundManager.setEffectOn(!1),this.voiceHandler(0,!0);break;case this.btn_soundOn:App.SoundManager.setEffectOn(!0),this.voiceHandler(100,!0)}},i.prototype.voiceHandler=function(t,e){e?(this.VoiceSlider.value=t,App.SoundManager.setEffectVolume(t/this.vMultiple)):(this.MusicSlider.value=t,App.SoundManager.setBgVolume(t/this.vMultiple))
},i.prototype.mainGroupClick=function(t){},i.prototype.closeHandle=function(e){App.EffectUtils.hideView(this,function(){App.ViewManager.close(t.ViewsConst.Setting)},this)},i}(base.GameView);t.SettingView=e,__reflect(e.prototype,"fishjoy.SettingView")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=t.call(this,null)||this;return e._mSpeed=0,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.initPlayedEndCallBack=function(t,e){this._mCallBack=t,this._mThisobj=e},e.prototype.updateId=function(t){this.initDBRes(t),this.armature=this.createArmature("Armature",t,e._mActionList),this.armature.addCompleteCallFunc(this.armaturePlayEnd,this)},e.prototype.setPosition=function(t,i){this.x=t,this.y=i,this.armature.play(e.Animation,1)},e.prototype.play=function(t){void 0===t&&(t=1),this._mSpeed=t,this.armature.play(e.Animation,999999,t),App.TimerManager.doFrame(1,99999,this.update,this)},e.prototype.update=function(t){this.x+=t/16*3*this._mSpeed,this.x>=App.StageUtils.getWidth()&&(this.x=0,this.armature.stop(),App.TimerManager.removeAll(this))},e.prototype.clean=function(){t.prototype.clean.call(this)},e.prototype.armaturePlayEnd=function(t){t.animationName==e.AnimationDead&&this._mCallBack&&this._mCallBack.call(this._mThisobj)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._mCallBack=void 0,this._mThisobj=void 0,this.armature=void 0},e.Animation="move",e.AnimationDead="dead",e._mActionList=[e.Animation,e.AnimationDead],e}(base.BaseGameObject);t.EffectBones=e,__reflect(e.prototype,"fishjoy.EffectBones")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(){function t(){}return t.List=1311,t}();t.ProxyKeyConst=e,__reflect(e.prototype,"fishjoy.ProxyKeyConst")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e;!function(t){t[t.Base=1100]="Base"}(e=t.RViewsConst||(t.RViewsConst={}))}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._proxy=null,t._view=null,t._helpView=null,Log.trace("RoomController init()"),t}return __extends(i,e),i.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.inits(),this.addListeners()},i.prototype.onInit=function(){e.prototype.onInit.call(this),this.registers(),App.ViewManager.open(t.ViewsConst.Base),this.updateTxt()},i.prototype.inits=function(){this._model=new t.RoomModel(this),this._proxy=new t.RoomProxy(this,this.getModel()),this._view=new t.RoomView(this),this._helpView=new t.HelpView(this)},i.prototype.registers=function(){App.ViewManager.register(t.ViewsConst.Base,this._view),App.ViewManager.register(t.ViewsConst.help,this._helpView),this.registerFunc("onClickBackRoom",this.onBack2Lobby,this),this.registerFunc("onEnterGame",this.onEnterGame,this),this.registerFunc("onHelpClick",this.showHelp,this)},i.prototype.showHelp=function(){App.ViewManager.open(t.ViewsConst.help)},i.prototype.updateTxt=function(){var t=this.player;this._view.updateMoney(t.getMoney())},i.prototype.onBack2Lobby=function(){this.goBack2Lobby()},i.prototype.onEnterGame=function(t){var e=GameModuleMgr.i.getGameByName("fishjoy"),i={sceneType:e.mArrGameType[t]};this.goEnterGame(i)},i.prototype.addListeners=function(){this._proxy.addEvent()},i.prototype.removeListeners=function(){this._proxy.removeEvent()},Object.defineProperty(i.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.destroy(),this._proxy.destroy(),this._view.destroy(),this._view=void 0,this._model=void 0,this._proxy=void 0},i}(base.RoomController);t.RoomController=e,__reflect(e.prototype,"fishjoy.RoomController")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roleName="",e}return __extends(e,t),e}(base.RoomModel);t.RoomModel=e,__reflect(e.prototype,"fishjoy.RoomModel")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),Object.defineProperty(e.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),e.prototype.addEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(base.RoomProxy);t.RoomProxy=e,__reflect(e.prototype,"fishjoy.RoomProxy")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){return e.call(this,t,LayerManager.Game_Main,"fishjoy","helpSkin")||this}return __extends(i,e),i.prototype.initUI=function(){},i.prototype.addEvent=function(){this.btnClose.addEventListener(egret.TouchEvent.TOUCH_END,this.closeHandle,this)},i.prototype.removeEvent=function(){this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_END,this.closeHandle,this)},i.prototype.closeHandle=function(e){App.ViewManager.close(t.ViewsConst.help)},i.prototype.close=function(){this.visible=!1},i}(base.GameView);t.HelpView=e,__reflect(e.prototype,"fishjoy.HelpView")}(fishjoy||(fishjoy={}));var fishjoy;!function(t){var e=function(e){function i(t){var i=e.call(this,t,LayerManager.Game_Bg,"fishjoy","RoomChooseSkin")||this;return i._mCount=0,i}return __extends(i,e),i.prototype.initUI=function(){e.prototype.initUI.call(this);for(var i=0;2>=i;i++)this["btnEnter"+i].name="btnEnter_"+i;this._mPartEffect=new BaseParticleObj,this._mPartEffect.init("part_fish_lobby"),this.addChild(this._mPartEffect),this._mPartEffect.play(),this._mPartEffect.x=-100,this._mPartEffect.y=-40,this.initBroadcast(this),t.SoundUtils.playHallBGM(),this.btnBackLobby.visible=!App.isWebInsert},i.prototype.onPay=function(){},i.prototype.onBackRoom=function(){this.applyFunc("onClickBackRoom")},i.prototype.onEnterGame=function(e){t.SoundUtils.playEnterSound();var i=e.split("_")[1];this.applyFunc("onEnterGame",parseInt(i))},i.prototype.updateMoney=function(t){this.uMoneyTxt.text=App.CommonUtils.money2Str(t)},i.prototype.onHelp=function(){this.applyFunc("onHelpClick"),Log.log("fish room help")},i.prototype.addEvent=function(){e.prototype.addEvent.call(this),App.EffectUtils.addEffectBtn(this.btnBackLobby,this.onBackRoom,this),App.EffectUtils.addEffectBtn(this.btnHelp,this.onHelp,this);for(var t=0;2>=t;t++)App.EffectUtils.addEffectBtn(this["btnEnter"+t],this.onEnterGame,this,this["btnEnter"+t].name,!0,.95,.95)},i.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),App.EffectUtils.removeEffectBtn(this.btnBackLobby),App.EffectUtils.removeEffectBtn(this.btnHelp);for(var t=0;2>=t;t++)App.EffectUtils.removeEffectBtn(this["btnEnter"+t])},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._mPartEffect&&this._mPartEffect.destroy(),this._mPartEffect=void 0},i}(base.RoomView);t.RoomView=e,__reflect(e.prototype,"fishjoy.RoomView")}(fishjoy||(fishjoy={}));